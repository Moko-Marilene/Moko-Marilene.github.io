<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="KOUGOUM Marilene">
<meta name="author" content="DEBA Franck">

<title>Introduction à la gestion des risques en Asset Management –</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-e31584831b205ffbb2d98406f31c2a5b.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>



<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../logo.png" alt="" class="navbar-logo light-content">
    <img src="../../logo.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title"></span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Accueil</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../finance.html"> 
<span class="menu-text">Finance Quantitative</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../risques/index.html"> 
<span class="menu-text">Risque &amp; Régulation</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../modelisation-stat.qmd"> 
<span class="menu-text">Modélisation stat</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../data-science.html"> 
<span class="menu-text">Data science</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../articles-ressources.qmd"> 
<span class="menu-text">Ressources</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">À propos</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#i.-risques-de-marché" id="toc-i.-risques-de-marché" class="nav-link" data-scroll-target="#i.-risques-de-marché">I. Risques de marché</a>
  <ul class="collapse">
  <li><a href="#i.1.-construction-dun-portefeuille-diversifié" id="toc-i.1.-construction-dun-portefeuille-diversifié" class="nav-link" data-scroll-target="#i.1.-construction-dun-portefeuille-diversifié">I.1. Construction d’un portefeuille diversifié</a></li>
  <li><a href="#i.2.-suivi-du-porte-feuille" id="toc-i.2.-suivi-du-porte-feuille" class="nav-link" data-scroll-target="#i.2.-suivi-du-porte-feuille">I.2. Suivi du porte feuille</a></li>
  </ul></li>
  <li><a href="#stress-test" id="toc-stress-test" class="nav-link" data-scroll-target="#stress-test">Stress test</a></li>
  <li><a href="#cadre-de-suivi-de-la-liquidité" id="toc-cadre-de-suivi-de-la-liquidité" class="nav-link" data-scroll-target="#cadre-de-suivi-de-la-liquidité">Cadre de suivi de la liquidité</a>
  <ul class="collapse">
  <li><a href="#la-méthodologie-de-calcul-dun-profil-découlement" id="toc-la-méthodologie-de-calcul-dun-profil-découlement" class="nav-link" data-scroll-target="#la-méthodologie-de-calcul-dun-profil-découlement">La méthodologie de calcul d’un profil d’écoulement</a></li>
  <li><a href="#profil-découlement-avec-déformation" id="toc-profil-découlement-avec-déformation" class="nav-link" data-scroll-target="#profil-découlement-avec-déformation">Profil d’écoulement avec déformation</a></li>
  <li><a href="#profil-découlement-sans-déformation" id="toc-profil-découlement-sans-déformation" class="nav-link" data-scroll-target="#profil-découlement-sans-déformation">Profil d’écoulement sans déformation</a></li>
  </ul></li>
  <li><a href="#ii.-risque-de-crédit-et-risque-de-taux" id="toc-ii.-risque-de-crédit-et-risque-de-taux" class="nav-link" data-scroll-target="#ii.-risque-de-crédit-et-risque-de-taux">II. Risque de crédit et risque de taux</a>
  <ul class="collapse">
  <li><a href="#généralités-sur-le-pricing-dobligations" id="toc-généralités-sur-le-pricing-dobligations" class="nav-link" data-scroll-target="#généralités-sur-le-pricing-dobligations">Généralités sur le pricing d’obligations</a></li>
  <li><a href="#impementation-de-la-valorisation-dun-bond" id="toc-impementation-de-la-valorisation-dun-bond" class="nav-link" data-scroll-target="#impementation-de-la-valorisation-dun-bond">Impementation de la valorisation d’un bond</a></li>
  <li><a href="#évolution-du-prix-de-lobligation-en-fonction-du-temps" id="toc-évolution-du-prix-de-lobligation-en-fonction-du-temps" class="nav-link" data-scroll-target="#évolution-du-prix-de-lobligation-en-fonction-du-temps">Évolution du prix de l’obligation en fonction du temps</a></li>
  <li><a href="#evolution-du-prix-plein-coupon-et-du-clean-price-en-fonction-du-temps-pour-differents-coupons" id="toc-evolution-du-prix-plein-coupon-et-du-clean-price-en-fonction-du-temps-pour-differents-coupons" class="nav-link" data-scroll-target="#evolution-du-prix-plein-coupon-et-du-clean-price-en-fonction-du-temps-pour-differents-coupons">Evolution du prix plein coupon et du clean price en fonction du temps pour differents coupons</a></li>
  <li><a href="#evolution-du-prix-de-lobligation-en-fonction-du-taux-dintérêt" id="toc-evolution-du-prix-de-lobligation-en-fonction-du-taux-dintérêt" class="nav-link" data-scroll-target="#evolution-du-prix-de-lobligation-en-fonction-du-taux-dintérêt">Evolution du prix de l’obligation en fonction du taux d’intérêt</a></li>
  <li><a href="#notion-de-sensibilité" id="toc-notion-de-sensibilité" class="nav-link" data-scroll-target="#notion-de-sensibilité">Notion de sensibilité</a></li>
  </ul></li>
  <li><a href="#iii.-risque-de-contrepartie" id="toc-iii.-risque-de-contrepartie" class="nav-link" data-scroll-target="#iii.-risque-de-contrepartie">III. Risque de contrepartie</a>
  <ul class="collapse">
  <li><a href="#lien-entre-cds-et-obligation-la-formule-du-triangle-de-crédit" id="toc-lien-entre-cds-et-obligation-la-formule-du-triangle-de-crédit" class="nav-link" data-scroll-target="#lien-entre-cds-et-obligation-la-formule-du-triangle-de-crédit">Lien entre CDS et obligation: la formule du triangle de crédit</a></li>
  <li><a href="#cds-principe" id="toc-cds-principe" class="nav-link" data-scroll-target="#cds-principe">CDS: principe</a></li>
  <li><a href="#sensibilité-de-crédit" id="toc-sensibilité-de-crédit" class="nav-link" data-scroll-target="#sensibilité-de-crédit">Sensibilité de crédit</a></li>
  <li><a href="#estimation-de-la-var-par-variation-conjointe-du-taux-dintérêt-et-du-spread-de-crédit" id="toc-estimation-de-la-var-par-variation-conjointe-du-taux-dintérêt-et-du-spread-de-crédit" class="nav-link" data-scroll-target="#estimation-de-la-var-par-variation-conjointe-du-taux-dintérêt-et-du-spread-de-crédit">Estimation de la VaR par variation conjointe du taux d’intérêt et du spread de crédit</a></li>
  </ul></li>
  <li><a href="#iv.-risque-modèle" id="toc-iv.-risque-modèle" class="nav-link" data-scroll-target="#iv.-risque-modèle">IV. Risque modèle</a></li>
  <li><a href="#v.risque-climatique" id="toc-v.risque-climatique" class="nav-link" data-scroll-target="#v.risque-climatique">V.Risque climatique</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Introduction à la gestion des risques en Asset Management</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Authors</div>
    <div class="quarto-title-meta-contents">
             <p>KOUGOUM Marilene </p>
             <p>DEBA Franck </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Ce document présente une introduction à la gestion des risques en Asset Management.<br>
L’objectif principal est de comprendre et d’appliquer les méthodologies de base utilisées pour analyser, mesurer et suivre les risques financiers au sein d’un portefeuille.</p>
<p>L’étude couvre differentes notions de risk management notamment:<br>
- les méthodes de mesure du risque de marché (sensibilité, volatilité, Value-at-Risk, Tracking Error, stress tests et profil de liquidité),<br>
- les composantes clés du risque de crédit (intensité de défaut, sensibilité des obligations aux variations de spreads, triangle du crédit),<br>
- le risque de contrepartie et ses mécanismes de mitigation via les appels de marge,<br>
- ainsi que les risques émergents tels que le risque climatique et le risque modèle.</p>
<div id="8bbe568a" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> yfinance <span class="im">as</span> yf</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> datetime, timedelta</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> math</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="i.-risques-de-marché" class="level2">
<h2 class="anchored" data-anchor-id="i.-risques-de-marché">I. Risques de marché</h2>
<section id="i.1.-construction-dun-portefeuille-diversifié" class="level3">
<h3 class="anchored" data-anchor-id="i.1.-construction-dun-portefeuille-diversifié">I.1. Construction d’un portefeuille diversifié</h3>
<p>On construit un portefeuille constitué de 10 entreprises du CAC40. Nous avons choisi des entreprises de secteurs variés afin de s’assurer que le portefeuille soit diversifié.</p>
<p>Ainsi, notre portefeuille est constitué des entreprises des secteurs suivants :</p>
<ul>
<li>Banque et assurance : BNP Paribas (BN.PA), Crédit Agricole (CA.PA)<br>
</li>
<li>Aéronautique et défense : Airbus (AIR.PA)<br>
</li>
<li>Technologie: Capgemini (CAP.PA)</li>
<li>Concession et Construction: Vinci (DG.PA)</li>
<li>Télécommunications : Orange (ORA.PA)<br>
</li>
<li>Énergie : Engie (ENGI.PA)<br>
</li>
<li>Luxe &amp; Consommation : LVMH (MC.PA)<br>
</li>
<li>Médias &amp; Divertissement : Vivendi (VIV.PA)<br>
</li>
<li>Industrie Chimique : Air Liquide (AI.PA)</li>
</ul>
<p>Nous allons procéder à une optimisation de Markowitz visant à construire un portefeuille qui minimise la volatilité (risque) sous la contrainte d’un niveau de rendement modulable en fonction du profil de risque de l’investisseur.</p>
<div id="ff11d2a0" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># On recupère les données sur un historique de deux ans</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>end_date <span class="op">=</span> <span class="st">'2025-03-16'</span>  </span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>start_date <span class="op">=</span> (datetime.strptime(end_date, <span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>) <span class="op">-</span> timedelta(days<span class="op">=</span><span class="dv">2</span><span class="op">*</span><span class="dv">365</span>)).strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">'AI.PA'</span>, <span class="st">'AIR.PA'</span>, <span class="st">'BN.PA'</span>, <span class="st">'CA.PA'</span>, <span class="st">'CAP.PA'</span>, <span class="st">'DG.PA'</span>, <span class="st">'ENGI.PA'</span>, <span class="st">'ORA.PA'</span>, <span class="st">'SAN.PA'</span>, <span class="st">'VIV.PA'</span>]</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> yf.download(tickers, start<span class="op">=</span>start_date, end<span class="op">=</span>end_date)[[<span class="st">'Close'</span>, <span class="st">'Volume'</span>]]</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>cac40 <span class="op">=</span> yf.download(<span class="st">'^FCHI'</span>, start<span class="op">=</span>start_date, end<span class="op">=</span>end_date)[[<span class="st">'Close'</span>, <span class="st">'Volume'</span>]]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\388541553.py:7: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df = yf.download(tickers, start=start_date, end=end_date)[['Close', 'Volume']]
[                       0%                       ][                       0%                       ][**************        30%                       ]  3 of 10 completed[*******************   40%                       ]  4 of 10 completed[*******************   40%                       ]  4 of 10 completed[*******************   40%                       ]  4 of 10 completed[*******************   40%                       ]  4 of 10 completed[**********************80%*************          ]  8 of 10 completed[**********************80%*************          ]  8 of 10 completed[*********************100%***********************]  10 of 10 completed
C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\388541553.py:8: FutureWarning: YF.download() has changed argument auto_adjust default to True
  cac40 = yf.download('^FCHI', start=start_date, end=end_date)[['Close', 'Volume']]
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="877be647" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>df_close <span class="op">=</span> df[<span class="st">'Close'</span>]</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>df_volume <span class="op">=</span> df[<span class="st">'Volume'</span>]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul des  rendements journaliers</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>returns <span class="op">=</span> df_close.pct_change()</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>returns.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="aperçu-des-données" class="level6">
<h6 class="anchored" data-anchor-id="aperçu-des-données">Aperçu des données</h6>
<div id="c2948c53" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Aperçu des données</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">3</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Price</th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">Close</th>
<th colspan="10" data-quarto-table-cell-role="th" data-halign="left">Volume</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Ticker</th>
<th data-quarto-table-cell-role="th">AI.PA</th>
<th data-quarto-table-cell-role="th">AIR.PA</th>
<th data-quarto-table-cell-role="th">BN.PA</th>
<th data-quarto-table-cell-role="th">CA.PA</th>
<th data-quarto-table-cell-role="th">CAP.PA</th>
<th data-quarto-table-cell-role="th">DG.PA</th>
<th data-quarto-table-cell-role="th">ENGI.PA</th>
<th data-quarto-table-cell-role="th">ORA.PA</th>
<th data-quarto-table-cell-role="th">SAN.PA</th>
<th data-quarto-table-cell-role="th">VIV.PA</th>
<th data-quarto-table-cell-role="th">AI.PA</th>
<th data-quarto-table-cell-role="th">AIR.PA</th>
<th data-quarto-table-cell-role="th">BN.PA</th>
<th data-quarto-table-cell-role="th">CA.PA</th>
<th data-quarto-table-cell-role="th">CAP.PA</th>
<th data-quarto-table-cell-role="th">DG.PA</th>
<th data-quarto-table-cell-role="th">ENGI.PA</th>
<th data-quarto-table-cell-role="th">ORA.PA</th>
<th data-quarto-table-cell-role="th">SAN.PA</th>
<th data-quarto-table-cell-role="th">VIV.PA</th>
</tr>
<tr class="header">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">2023-03-17</th>
<td>126.875404</td>
<td>110.644333</td>
<td>49.379742</td>
<td>14.572609</td>
<td>157.424210</td>
<td>91.923409</td>
<td>10.256954</td>
<td>8.935349</td>
<td>79.612030</td>
<td>8.390329</td>
<td>1971502</td>
<td>2171272</td>
<td>3041249</td>
<td>4474936</td>
<td>719990</td>
<td>3575676</td>
<td>12989586</td>
<td>20039590</td>
<td>5122220</td>
<td>7405822</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2023-03-20</th>
<td>129.684891</td>
<td>112.407204</td>
<td>49.742428</td>
<td>14.783135</td>
<td>157.659653</td>
<td>93.078445</td>
<td>10.359279</td>
<td>9.040172</td>
<td>79.310608</td>
<td>8.565088</td>
<td>1139355</td>
<td>1290939</td>
<td>1697298</td>
<td>2379408</td>
<td>418826</td>
<td>1207887</td>
<td>7087933</td>
<td>9795603</td>
<td>2119074</td>
<td>2624806</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2023-03-21</th>
<td>129.288467</td>
<td>115.250557</td>
<td>50.186718</td>
<td>14.955767</td>
<td>160.579285</td>
<td>95.104210</td>
<td>10.579202</td>
<td>9.144996</td>
<td>79.948921</td>
<td>8.741748</td>
<td>745105</td>
<td>1002062</td>
<td>2018104</td>
<td>2130100</td>
<td>293112</td>
<td>934999</td>
<td>7313789</td>
<td>9077226</td>
<td>1449009</td>
<td>2962587</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Comme indicateur quantifiable de cette diversification nous presentons ci après la matrice de correlation entre les rendements journaliers des actifs du portefeuille pour notre période d’étude.</p>
<div id="367e4567" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la matrice de corrélation</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>corr_actifs <span class="op">=</span> returns.corr().to_numpy()</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Affichage du corrélogramme</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>sns.heatmap(corr_actifs, annot<span class="op">=</span><span class="va">True</span>, fmt<span class="op">=</span><span class="st">'.2f'</span>, cmap<span class="op">=</span><span class="st">'coolwarm'</span>, xticklabels<span class="op">=</span>returns.columns, yticklabels<span class="op">=</span>returns.columns)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Corrélogramme des actifs"</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-6-output-1.png" width="734" height="654" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="i.1.1-présentation-du-principe-doptimisation-de-markovitz" class="level4">
<h4 class="anchored" data-anchor-id="i.1.1-présentation-du-principe-doptimisation-de-markovitz">I.1.1 Présentation du principe d’optimisation de Markovitz</h4>
<p>L’optimisation de Markowitz, également connue sous le nom de théorie moderne du portefeuille (MPT), permet de construire un portefeuille optimal en combinant des actifs de manière à minimiser la volatilité (ou le risque) tout en respectant une contrainte sur un niveau de rendement fixé. L’un des éléments clés de cette théorie est la détermination des poids de chaque actif dans le portefeuille, afin d’atteindre un compromis optimal entre le risque et le rendement.</p>
<p>Hypothèses principales :</p>
<ol type="1">
<li>Les décisions sont prises en fonction du couple rendement-risque.<br>
</li>
<li>Les investisseurs cherchent à diversifier leurs actifs pour réduire le risque.<br>
</li>
<li>L’accès au taux sans risque est illimité.<br>
</li>
<li>Aucun coût de transaction n’est pris en compte.</li>
</ol>
<p>Programme d’optimisation : L’objectif est de minimiser la volatilité sous la contrainte d’un rendement cible $ _T $ :<br>
<span class="math display">\[
\text{Minimiser } \omega^t\Sigma \omega
\]</span> Sous les contraintes :</p>
$$
<span class="math display">\[\begin{cases}
    \omega^t \mu = \mu_T \\
    \sum_{i=1}^{n} \omega_i = 1

\end{cases}\]</span>
<p>$$</p>
</section>
<section id="i.1.2-calcul-des-rendements-annualisées-et-des-volatilités-annualisés-des-log_rendements-pour-chaque-actif" class="level4">
<h4 class="anchored" data-anchor-id="i.1.2-calcul-des-rendements-annualisées-et-des-volatilités-annualisés-des-log_rendements-pour-chaque-actif">I.1.2 Calcul des rendements annualisées et des volatilités annualisés des log_rendements pour chaque actif</h4>
<div id="674b83c2" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendement annualisé</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>mean_daily_return<span class="op">=</span> returns.mean()</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>yearly_return <span class="op">=</span> (<span class="dv">1</span><span class="op">+</span> mean_daily_return)<span class="op">**</span><span class="dv">252</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co"># volatilité annualisé</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> returns.cov().to_numpy()</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="dv">252</span><span class="op">*</span>sigma</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="i.1.3.-optimisation-du-portefeuille" class="level4">
<h4 class="anchored" data-anchor-id="i.1.3.-optimisation-du-portefeuille">I.1.3. Optimisation du portefeuille</h4>
<p>L’investisseur a la latitude de shorter ou pas (via l’argument <em>Positive</em> de la foncion efficient_portfolio qui donne la latitude de lever la contrainte de positivité des coefficients), également de definir le niveau de rendement souhaité (via l’argument <em>mu_target</em> de la même fonction).</p>
<p>Dans le cadre de l’exercice, pour des raisons de simplification et pour rester cohérent avec la suite, nous avons opté pour un portefeuille sur des positions longues.</p>
<div id="3253cf39" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendement annualisé</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>mean_daily_return<span class="op">=</span> returns.mean()</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>yearly_return <span class="op">=</span> (<span class="dv">1</span><span class="op">+</span> mean_daily_return)<span class="op">**</span><span class="dv">252</span> <span class="op">-</span><span class="dv">1</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="co"># volatilité annualisé</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> returns.cov().to_numpy()</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="dv">252</span><span class="op">*</span>sigma</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="i.1.3.-optimisation-du-portefeuille-1" class="level4">
<h4 class="anchored" data-anchor-id="i.1.3.-optimisation-du-portefeuille-1">I.1.3. Optimisation du portefeuille</h4>
<p>L’investisseur a la latitude de shorter ou pas (via l’argument <em>Positive</em> de la foncion efficient_portfolio qui donne la latitude de lever la contrainte de positivité des coefficients), également de definir le niveau de rendement souhaité (via l’argument <em>mu_target</em> de la même fonction).</p>
<p>Dans le cadre de l’exercice, pour des raisons de simplification et pour rester cohérent avec la suite, nous avons opté pour un portefeuille sur des positions longues.</p>
<div id="1d18c38f" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.optimize <span class="im">import</span> minimize</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Nombre d'actifs</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>n_assets <span class="op">=</span> <span class="bu">len</span>(yearly_return)</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>mu <span class="op">=</span> yearly_return</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> portfolio_variance(weights):</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weights.T <span class="op">@</span> sigma <span class="op">@</span> weights</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> weight_sum_constraint(weights):</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> np.<span class="bu">sum</span>(weights) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> target_return_constraint(weights, mu_target):</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> weights.T <span class="op">@</span> mu <span class="op">-</span> mu_target</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> efficient_portfolio(mu_target, range_<span class="op">=</span>(<span class="op">-</span><span class="fl">0.1</span>, <span class="va">None</span>), positive<span class="op">=</span><span class="va">True</span>):</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># On initialise les poids de maniere équitable</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>    init_weights <span class="op">=</span> np.ones(n_assets) <span class="op">/</span> n_assets</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Contraintes</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    constraints <span class="op">=</span> [</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: weight_sum_constraint},</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'type'</span>: <span class="st">'eq'</span>, <span class="st">'fun'</span>: <span class="kw">lambda</span> w: target_return_constraint(w, mu_target)}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># On verifie si on a définit une contrainte de positivité</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> positive:</span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a>        bounds <span class="op">=</span> [(<span class="dv">0</span>, <span class="va">None</span>) <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_assets)]  <span class="co"># Chaque poids doit être &gt;= 0</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>        bounds <span class="op">=</span> [range_ <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_assets)] </span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Optimisation</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    result <span class="op">=</span> minimize(portfolio_variance, init_weights, bounds<span class="op">=</span>bounds, method<span class="op">=</span><span class="st">'SLSQP'</span>, constraints<span class="op">=</span>constraints)</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> result.success:</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>        optimal_weights <span class="op">=</span> result.x</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>        portfolio_volatility <span class="op">=</span> np.sqrt(portfolio_variance(optimal_weights))</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> portfolio_volatility, optimal_weights</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>, <span class="va">None</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="i.1.4-illustration-pour-un-rendement-cible-de-10" class="level4">
<h4 class="anchored" data-anchor-id="i.1.4-illustration-pour-un-rendement-cible-de-10">I.1.4 Illustration pour un rendement cible de 10%</h4>
<p>Pour un rendement annuel cible de 10%, correspondant à l’ordre de grandeur des rendements du CAC40 qui représente le benchmark du fond, les poids optimaux donnés par le l’optimisation de Markovitz et qui ont permis de minimiser le risque auquel est exposé le porte feuille ( 9.67% de volatilité) sont donnés ci après:</p>
<div id="576d5aa3" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendement cible</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>mu_target <span class="op">=</span> <span class="fl">0.1</span> </span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># les poids optimaux et la volatilité</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>vol, weights <span class="op">=</span> efficient_portfolio(mu_target)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Le portefeuille ainsi construit a un rendement de"</span>,<span class="bu">round</span>(weights.T <span class="op">@</span> mu,<span class="dv">4</span>), <span class="st">"et est soumis à une volatilité de l'ordre de :"</span>, <span class="bu">round</span>(vol,<span class="dv">4</span>), <span class="st">"</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"---"</span><span class="op">*</span><span class="dv">50</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Les poids associés aux actifs du porte feuille sont listés ci après:</span><span class="ch">\n</span><span class="st">"</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> column <span class="kw">in</span> df_close.columns.tolist():</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>column<span class="sc">}</span><span class="ss">, </span><span class="sc">{</span>weights[i]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Le portefeuille ainsi construit a un rendement de 0.1 et est soumis à une volatilité de l'ordre de : 0.0989 

------------------------------------------------------------------------------------------------------------------------------------------------------
Les poids associés aux actifs du porte feuille sont listés ci après:

AI.PA, 0.0243
AIR.PA, 0.0382
BN.PA, 0.2031
CA.PA, 0.1929
CAP.PA, 0.1255
DG.PA, 0.0000
ENGI.PA, 0.0732
ORA.PA, 0.2652
SAN.PA, 0.0542
VIV.PA, 0.0234</code></pre>
</div>
</div>
<div id="e5450b15" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> plt.bar(df_close.columns.tolist(), weights<span class="op">*</span><span class="dv">100</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Poids optimaux des actifs dans le portefeuille (Volatilité: </span><span class="sc">{</span><span class="bu">round</span>(vol, <span class="dv">4</span>)<span class="sc">}</span><span class="ss">)"</span>)</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Actifs"</span>)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Poids (en %)"</span>)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout des étiquettes sur chaque barre</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, weight <span class="kw">in</span> <span class="bu">zip</span>(bars, weights):</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    plt.text(bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>, bar.get_height(),</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>             <span class="ss">f'</span><span class="sc">{</span><span class="bu">round</span>(weight<span class="op">*</span><span class="dv">100</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-11-output-1.png" width="950" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>On constate que le portefeuille optimal est assez diversifié.Les trois principales entreipes representées sont :</p>
<ul>
<li>Télécommunications : Orange (26.53%)</li>
<li>Banque et assurance: BNP Paribas (20.24%), Credit Agricole (19.27%)</li>
<li>Technologie : Capgemini (12.52%)</li>
<li>Énergie : Engie (7.30%)</li>
</ul>
</section>
</section>
<section id="i.2.-suivi-du-porte-feuille" class="level3">
<h3 class="anchored" data-anchor-id="i.2.-suivi-du-porte-feuille">I.2. Suivi du porte feuille</h3>
<p>Dans cette section on va determiner l’AUM du portefeuille, suivre ses performances sa volatilité et ses performances relatives par rapport au CAC40.</p>
<p>Nous effectuerons également un stress test sur le portefeuille pour ebaluer sa sensibilité relative à la période COVID.</p>
<div id="a9398e39" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Poids des actions dans le portefeuille</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> pd.DataFrame({<span class="st">'Ticker'</span>: tickers ,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>     <span class="st">'Weight'</span>: weights})</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> weights.set_index(<span class="st">'Ticker'</span>)[<span class="st">'Weight'</span>]</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a><span class="co">#print(weights)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="i.2.1.-aum-asset-under-management" class="level4">
<h4 class="anchored" data-anchor-id="i.2.1.-aum-asset-under-management">I.2.1. AUM (Asset under management)</h4>
<p>Elle représente la valeur du porte feuille et est déterminée par la formule suivante</p>
<p>AUM = (NAV)(Nombre_de_ parts)</p>
<p>Avec</p>
<p>La Net Value Asset (NAV) représente la valeur nette d’une part du fonds (portefeuille) à un moment donné.</p>
<section id="détermination-de-laum" class="level5">
<h5 class="anchored" data-anchor-id="détermination-de-laum">Détermination de l’AUM</h5>
<div id="2a5de225" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Détermination de l'AUM</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>aum <span class="op">=</span> df_close<span class="op">@</span>weights</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>portfolio <span class="op">=</span> pd.DataFrame({<span class="st">'AUM'</span>: aum})</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>portfolio.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AUM</th>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">Date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">2023-03-17</th>
<td>47.527177</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2023-03-20</th>
<td>47.829467</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2023-03-21</th>
<td>48.500885</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">2023-03-22</th>
<td>48.360237</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">2023-03-23</th>
<td>48.621806</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div id="f7cbac40" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>portfolio.describe()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">AUM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<th data-quarto-table-cell-role="th">count</th>
<td>509.000000</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">mean</th>
<td>53.563795</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">std</th>
<td>3.084850</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">min</th>
<td>47.527177</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">25%</th>
<td>50.547954</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">50%</th>
<td>53.835647</td>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">75%</th>
<td>56.161594</td>
</tr>
<tr class="even">
<th data-quarto-table-cell-role="th">max</th>
<td>59.243527</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<p>Sur notre période d’etude, l’AUM en moyenne est de 59.10, et oscille entre 50.68 et 66.84.</p>
</section>
</section>
<section id="i.2.2-performance-du-portefeuille" class="level4">
<h4 class="anchored" data-anchor-id="i.2.2-performance-du-portefeuille">I.2.2 Performance du portefeuille</h4>
<p>Dans le cadre du suivi de notre portfeuille, il est important d’identifier et de mesurer les risques auxquels il est exposé afin de mieux les encadrer. Dans cette section nous intéressons tout particulièrement au risque de marché. Ce risque peut être évalué à l’aide de:</p>
<ul>
<li>La tracking error</li>
<li>La volatilité</li>
<li>La VaR</li>
</ul>
<p>qui sont des mesures ex-ante.</p>
<section id="on-sintéresse-aux-performances-du-portefeuille-construit-ainsi-que-celles-du-benchmark" class="level6">
<h6 class="anchored" data-anchor-id="on-sintéresse-aux-performances-du-portefeuille-construit-ainsi-que-celles-du-benchmark">On s’intéresse aux performances du portefeuille construit ainsi que celles du benchmark</h6>
<div id="5ef3eb8d" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance du portefeuille</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>portfolio[<span class="st">'perf'</span>] <span class="op">=</span> portfolio[<span class="st">'AUM'</span>].pct_change()</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>portfolio.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Performance du benchmark</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>cac40_df <span class="op">=</span> cac40[<span class="st">'Close'</span>]</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>cac40_df [<span class="st">'perf'</span>] <span class="op">=</span> cac40_df.pct_change()</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>cac40_df.dropna(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rendement annualisé du fond: </span><span class="ch">\t</span><span class="st">"</span>, (<span class="dv">1</span><span class="op">+</span>portfolio.perf.mean())<span class="op">**</span><span class="dv">252</span> <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Rendement annualisé du CAC40: </span><span class="ch">\t</span><span class="st">"</span>, (<span class="dv">1</span><span class="op">+</span>cac40_df.perf.mean())<span class="op">**</span><span class="dv">252</span> <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"Performance relative du fond: </span><span class="ch">\t</span><span class="st">"</span>, (<span class="dv">1</span><span class="op">+</span>portfolio.perf.mean())<span class="op">**</span><span class="dv">252</span> <span class="op">-</span> (<span class="dv">1</span><span class="op">+</span>cac40_df.perf.mean())<span class="op">**</span><span class="dv">252</span> )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rendement annualisé du fond:     0.08254785047977653
Rendement annualisé du CAC40:    0.08502178188176579
Performance relative du fond:    -0.00247393140198926</code></pre>
</div>
</div>
<p>La performance absolue du fonds est de 8.24%, tandis que celle du CAC40 est de 8.50%. Pour évaluer la performance relative du fonds par rapport à son indice de référence, on calcule l’écart de performance : -0.256%. Cela signifie que le portefeuille sous-performe par rapport à son benchmark.</p>
</section>
</section>
<section id="i.2.2.1-tracking-error" class="level4">
<h4 class="anchored" data-anchor-id="i.2.2.1-tracking-error">I.2.2.1 Tracking error</h4>
<p>La Tracking Error (TE) mesure l’écart de performance entre un fonds et son indice de référence (benchmark). Elle est définie comme l’écart-type des différences de rendement entre le fonds et le benchmark sur une période donnée. Plus la Tracking Error est faible, plus le fonds suit fidèlement son indice de référence.</p>
<p><span class="math display">\[
TE = \sqrt{\frac{\sum_1^n (r_{fond} - r_{benchmark})^2}{n-1}}
\]</span></p>
<div id="b8c75bb2" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Tracking error</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>portfolio[<span class="st">'benchmark'</span>] <span class="op">=</span> cac40_df[<span class="st">'perf'</span>]</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>portfolio[<span class="st">'tracking_error'</span>] <span class="op">=</span> portfolio[<span class="st">'perf'</span>] <span class="op">-</span> portfolio[<span class="st">'benchmark'</span>]</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>TError <span class="op">=</span> portfolio[<span class="st">'tracking_error'</span>].std()<span class="op">*</span>np.sqrt(<span class="dv">252</span>) <span class="co"># Annualisation</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>TError</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>np.float64(0.10911787788473695)</code></pre>
</div>
</div>
<p>Il ressort que la dispersion des rendements du fond par rapport ceux de son indice de reférence est de 10.8% en moyenne.</p>
</section>
<section id="i.2.2.2-volatilité" class="level4">
<h4 class="anchored" data-anchor-id="i.2.2.2-volatilité">I.2.2.2 Volatilité</h4>
<p>Afin d’evaluer le risque de marché du fond, la volatilité complète l’information apportée par la tracking error et permet de se faire une idée sur la regularité et la dispersion des rendements du fond sur la periode d’étude. Il s’agit de l’écart-type des performances absolues du fond.</p>
<section id="volatilité-annualisé-du-portefeuille" class="level6">
<h6 class="anchored" data-anchor-id="volatilité-annualisé-du-portefeuille">Volatilité annualisé du portefeuille</h6>
<div id="e8eb241d" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Volatilité annualisé du portefeuille</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>std_dev <span class="op">=</span> portfolio.std()<span class="op">*</span>np.sqrt(<span class="dv">252</span>)</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>std_dev</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>AUM               48.833280
perf               0.132069
benchmark          0.128884
tracking_error     0.109118
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="volatilité-du-benchmark" class="level6">
<h6 class="anchored" data-anchor-id="volatilité-du-benchmark">Volatilité du benchmark</h6>
<div id="0d0b8be9" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Volatilité du benchmark</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>cac40_df.std()<span class="op">*</span>np.sqrt(<span class="dv">252</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<pre><code>Ticker
^FCHI    5304.018890
perf        0.128884
dtype: float64</code></pre>
</div>
</div>
</section>
</section>
<section id="i.2.2.3-value-at-risk" class="level4">
<h4 class="anchored" data-anchor-id="i.2.2.3-value-at-risk">I.2.2.3 Value at risk</h4>
<p>La value-at-risk (VaR) est une mesure très répendue en gestion de risques. Elle permet d’evaluer les pertes extrêmes encourrues sur un portefeuille sur un horizon donné sous un niveau de confiance. Elle est généralement calculée sur un horizon 1 jour. Pour obtenir une VaR sur un horizon (H) plus grand, on utilise la méthode de scaling qui consiste à multpiplier la VaR 1 jour par la racine carrée de H.</p>
<p>Elle est donnée par <span class="math inline">\(\mathbf{P}(P \&amp; L &lt; VaR_H) = \alpha\)</span></p>
<p>La VaR est déterminée à l’aide diverses approches: - Approche historique: Elle consiste à calculer le quantile empirique d’ordre <span class="math inline">\(\alpha\)</span> des pertes historiques. C’est l’approche la plus utilisée en pratique. Cette méthode présente toutefois des limites en cas de changement soudain et inhabituel de conjoncture (crise etc.)</p>
<ul>
<li>Approche paramétrique: Ici on fait l’hypothèse que les P&amp;L sont distribués suivant un loi dont les paramètres sont calibrés sur les données historiques. Comme toute méthode paramétrique, elle peut conduire à des estimations très biaisées si la loi supposée n’est pas adaptée aux données</li>
</ul>
<section id="visualisation-de-la-distribution-des-log-rendements-journaliers" class="level6">
<h6 class="anchored" data-anchor-id="visualisation-de-la-distribution-des-log-rendements-journaliers">Visualisation de la distribution des log-rendements journaliers</h6>
<div id="937542ba" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>sns.histplot(portfolio.perf)</span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>sns.kdeplot(portfolio.perf, color<span class="op">=</span><span class="st">'red'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-19-output-1.png" width="586" height="429" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="on-sinteresse-aux-var-sur-un-horizon-de-20-jours" class="level4">
<h4 class="anchored" data-anchor-id="on-sinteresse-aux-var-sur-un-horizon-de-20-jours">On s’interesse aux VaR sur un horizon de 20 jours</h4>
</section>
<section id="a-var-historique" class="level4">
<h4 class="anchored" data-anchor-id="a-var-historique">(a) VaR historique</h4>
<div id="a05e0ce3" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>VaR <span class="op">=</span> portfolio.quantile(<span class="dv">1</span><span class="op">-</span><span class="fl">0.99</span>)<span class="op">*</span>np.sqrt(<span class="dv">20</span>) <span class="co"># 1-day VaR scaled to 20-day VaR</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"la VaR  P&amp;L à 99</span><span class="sc">% d</span><span class="st">'horizon 20 jours  est :"</span>,VaR[<span class="dv">1</span>])</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"la VaR  Relative à 99</span><span class="sc">% d</span><span class="st">'horizon 20 jours  est :"</span>,VaR[<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>la VaR  P&amp;L à 99% d'horizon 20 jours  est : -0.09788047199168412
la VaR  Relative à 99% d'horizon 20 jours  est : -0.08993815186398733</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\764873701.py:2: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  print("la VaR  P&amp;L à 99% d'horizon 20 jours  est :",VaR[1])
C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\764873701.py:3: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  print("la VaR  Relative à 99% d'horizon 20 jours  est :",VaR[3])</code></pre>
</div>
</div>
<p>La perte maximale attendue sur un horizon de 20 jours avec un niveau de confiance de 99% est de 9.66%. Le porte feuille a 99% de chance de sous performer son indice de reference de 8.96% sur un horizon de 20 jours.</p>
</section>
<section id="b-var-paramétrique" class="level4">
<h4 class="anchored" data-anchor-id="b-var-paramétrique">(b) VaR paramétrique</h4>
<div id="196b958c" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>VaR <span class="op">=</span> (portfolio.mean() <span class="op">+</span> norm.ppf(<span class="dv">1</span><span class="op">-</span><span class="fl">0.99</span>)<span class="op">*</span>portfolio.std())<span class="op">*</span>np.sqrt(<span class="dv">20</span>)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"la VaR  P&amp;L à 99</span><span class="sc">% d</span><span class="st">'horizon 20 jours  est :"</span>,VaR[<span class="dv">1</span>])</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">"la VaR  Relative  à 99</span><span class="sc">% d</span><span class="st">'horizon 20 jours  est :"</span>,VaR[<span class="dv">3</span>])</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>la VaR  P&amp;L à 99% d'horizon 20 jours  est : -0.08514683127950859
la VaR  Relative  à 99% d'horizon 20 jours  est : -0.07155357198997868</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\937860044.py:2: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  print("la VaR  P&amp;L à 99% d'horizon 20 jours  est :",VaR[1])
C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\937860044.py:3: FutureWarning: Series.__getitem__ treating keys as positions is deprecated. In a future version, integer keys will always be treated as labels (consistent with DataFrame behavior). To access a value by position, use `ser.iloc[pos]`
  print("la VaR  Relative  à 99% d'horizon 20 jours  est :",VaR[3])</code></pre>
</div>
</div>
<p>La perte maximale attendue sur un horizon de 20 jours avec un niveau de confiance de 99% est de 8.47%. Le porte feuille a 99% de chance de sous performer son indice de reference de 7.10% sur un horizon de 20 jours.</p>
<p>On observe que les VaR paramétriques sont strictement inférieures aux VaR historiques. Ceci pourrait s’expliquer par le fait que les données ont des queues plus lourdes que la loi normale comme l’illustre le graphique présenté plus haut. De plus l’excess de kurtosis confirme cette observation. Par conséquent, la VaR obtenue sous une paramétrisation gaussienne sous-estime la perte maximale encourrue sur le portefeuille.</p>
<hr>
</section>
</section>
</section>
<section id="stress-test" class="level2">
<h2 class="anchored" data-anchor-id="stress-test">Stress test</h2>
<p>Le stress test ou test de résistance est un exercice qui consiste à reproduire des scénarios extrêmes sur un portefeuille afin d’évaluer sa résilience en conjoncture défavorable. On distingue notamment deux types de stress test: - Le stress test historique qui vise à reproduire des scénarios de crises historisques, - Le stress test hypothétique qui consiste à considérer des scénarios théoriques extrêmes.</p>
<p>Nous allons dans la suite implémenter un stress test historique en reproduisant le choc COVID entre 19/02/2020 et 19/03/2020. Il s’agit s’agira de calculer la performance du fonds entre ces deux date et de la comparer à celle de son indice de référence.</p>
<section id="données-des-actions-en-période-covid" class="level4">
<h4 class="anchored" data-anchor-id="données-des-actions-en-période-covid">Données des actions en période covid</h4>
<div id="36be3c92" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Données des actions en période covid</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>stress_date_1 <span class="op">=</span> <span class="st">"2020-02-19"</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>stress_date_2 <span class="op">=</span> <span class="st">"2020-03-19"</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>tickers <span class="op">=</span> [<span class="st">'SAN.PA'</span>, <span class="st">'BN.PA'</span>,  <span class="st">'AIR.PA'</span>, <span class="st">'AI.PA'</span>, <span class="st">'ORA.PA'</span>, <span class="st">'CAP.PA'</span>, <span class="st">'VIV.PA'</span>, <span class="st">'CA.PA'</span>, <span class="st">'ENGI.PA'</span>, <span class="st">'DG.PA'</span>]</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>df_stress <span class="op">=</span> yf.download(tickers, start <span class="op">=</span> stress_date_1, end<span class="op">=</span>stress_date_2)[<span class="st">'Close'</span>]</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>cac40_stress <span class="op">=</span> yf.download(<span class="st">'^FCHI'</span>, start <span class="op">=</span> stress_date_1, end<span class="op">=</span>stress_date_2)[<span class="st">'Close'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\3326232529.py:6: FutureWarning: YF.download() has changed argument auto_adjust default to True
  df_stress = yf.download(tickers, start = stress_date_1, end=stress_date_2)['Close']
[                       0%                       ][**********            20%                       ]  2 of 10 completed[**********            20%                       ]  2 of 10 completed[*******************   40%                       ]  4 of 10 completed[*******************   40%                       ]  4 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************60%****                   ]  6 of 10 completed[**********************90%******************     ]  9 of 10 completed[*********************100%***********************]  10 of 10 completed
C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\3326232529.py:7: FutureWarning: YF.download() has changed argument auto_adjust default to True
  cac40_stress = yf.download('^FCHI', start = stress_date_1, end=stress_date_2)['Close']
[*********************100%***********************]  1 of 1 completed</code></pre>
</div>
</div>
<div id="3844a98c" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>aum_stress <span class="op">=</span> df_stress<span class="op">@</span>weights</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>portfolio_stress <span class="op">=</span> pd.DataFrame({<span class="st">'AUM'</span>: aum_stress})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="rendement-du-portefeuille-en-période-de-covid" class="level4">
<h4 class="anchored" data-anchor-id="rendement-du-portefeuille-en-période-de-covid">Rendement du portefeuille en période de covid</h4>
<div id="c39136c1" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendement du portefeuille en période de covid</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>portfolio_stress.iloc[<span class="op">-</span><span class="dv">1</span>,] <span class="op">/</span>portfolio_stress.iloc[<span class="dv">0</span>,]  <span class="op">-</span> <span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<pre><code>AUM   -0.335339
dtype: float64</code></pre>
</div>
</div>
</section>
<section id="rendement-du-benchmark-enn-période-covid" class="level4">
<h4 class="anchored" data-anchor-id="rendement-du-benchmark-enn-période-covid">Rendement du benchmark enn période covid</h4>
<div id="1f13c26b" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendemnt du benchmark enn période covid</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>cac40_stress.iloc[<span class="op">-</span><span class="dv">1</span>,] <span class="op">/</span> cac40_stress.iloc[<span class="dv">0</span>,] <span class="op">-</span><span class="dv">1</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>Ticker
^FCHI   -0.385585
dtype: float64</code></pre>
</div>
</div>
<p>Le fonds stressé a une performance absolue de -33.69% contre -38.55% pour son benchmark. Ces performances en période de crise COVID sont du même ordre de grandeur. Toutefois, la perte enregistrée sur le fonds est moins importante. Une analyse des performances des actions constituant le fonds montre que la sous-performance enegistrée est essentiellement portée par: Air Liquide, Capgenie et Engie.</p>
</section>
<section id="rendement-du-portefeuille-en-période-de-covid-1" class="level4">
<h4 class="anchored" data-anchor-id="rendement-du-portefeuille-en-période-de-covid-1">Rendement du portefeuille en période de covid</h4>
<div id="c082ec26" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rendement du portefeuille en période de covid</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>df_stress.iloc[<span class="op">-</span><span class="dv">1</span>,] <span class="op">/</span>df_stress.iloc[<span class="dv">0</span>,]  <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>bars <span class="op">=</span> plt.bar(df_close.columns.tolist(), df_stress.iloc[<span class="op">-</span><span class="dv">1</span>,] <span class="op">/</span>df_stress.iloc[<span class="dv">0</span>,]  <span class="op">-</span> <span class="dv">1</span>, color<span class="op">=</span><span class="st">'skyblue'</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="ss">f"Performance de la composition du fond stressé"</span>)</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Actifs"</span>)</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Performance (%)"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>plt.xticks(rotation<span class="op">=</span><span class="dv">45</span>, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Ajout des étiquettes sur chaque barre</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> bar, weight <span class="kw">in</span> <span class="bu">zip</span>(bars, df_stress.iloc[<span class="op">-</span><span class="dv">1</span>,] <span class="op">/</span>df_stress.iloc[<span class="dv">0</span>,]  <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    plt.text(bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>, bar.get_height(),</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>             <span class="ss">f'</span><span class="sc">{</span><span class="bu">round</span>(weight<span class="op">*</span><span class="dv">100</span>, <span class="dv">2</span>)<span class="sc">}</span><span class="ss">'</span>, ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-26-output-1.png" width="950" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="cadre-de-suivi-de-la-liquidité" class="level2">
<h2 class="anchored" data-anchor-id="cadre-de-suivi-de-la-liquidité">Cadre de suivi de la liquidité</h2>
<hr>
<p>Le suivi de la liquidité est d’une importance centrale en gestion de fonds et est encadré par des exigences règlementaires. Il s’agit entre autres pour le gestionnaire de pouvoir honorer ses engagements vis-à-vis de des investisseurs en cas de rachat de parts du fonds. Il faut donc s’assurer de la capacité à revendre les actifs composant le fonds dans des délais courts sans toutefois les brader.</p>
<p>C’est ce qu’on appelle le risque de liquidité qui se défini plus formellement comme étant la facilité avec laquelle une entreprise peut échanger ses actifs contre du cash, même en situation soudaine de besoin de liquidité, sans subir de coûts anormaux par rapport aux autres acteurs du marché.</p>
<p>Le suivi de la liquidité d’un fonds s’effectue par le calcul de son profil d’écoulement en condition normale et en condition stressée.</p>
<section id="la-méthodologie-de-calcul-dun-profil-découlement" class="level3">
<h3 class="anchored" data-anchor-id="la-méthodologie-de-calcul-dun-profil-découlement">La méthodologie de calcul d’un profil d’écoulement</h3>
<p>Le fonds est constitué de n actifs en quantité <span class="math inline">\(Q_i\)</span> chacun à liquider. Dans la pratique il existe une quantité maximale au delà de laquelle les échanges ne peuvent se faire sans subir de coûts anormaux: c’est la profondeur de marché. Le coût de liquidation est induit par les volume d’ordre émis.</p>
<p>La profondeur de marché est généralement estimée en examinant: - Les carnets d’ordres ou - Les volumes quotidiens échangés: On considère notamment le volume quotidien moyen échangé sur 3 mois appelé <em>ADV</em> ou <em>ATV</em> (Average Daily/Traded Volume). La profondeur de marché est alors estimée par <span class="math inline">\(Q^* = 20\% \times ADV_{3 mois}\)</span></p>
<hr>
<p>On distingue quatre profils d’écoulement: - En codition normale: avec et sans déformation - En condition stressée: avec déformation et sans déformation</p>
<p>Dans une <em>liquidation avec déformation</em>, les actifs les plus liquides sont liquidés en premiers. La déformation du portefeuille s’illustre par les changements de poids des différents émetteurs dans le fonds. La <em>liquidation sans déformation</em> quant à elle consistera à liquider le fonds au rythme de l’actif le moins liquide afin de préserver les poids initiaux.</p>
<p><em>N.B: Le profil de liquidation est représenté en proportion du portefeuille initial.</em></p>
<p>On utilise le profil de liquidité pour déterminer la taille optimal du fonds permettant de respecter les exigence de minimum de liquidité. Il s’agira de s’assurer que plus de 90% du fonds est liquidé en deux jours, laissant ainsi un maximum de 10 % dans la catégorie dite “<em>poubelle</em>” (c’est-à-dire les actifs moins liquides).</p>
<p>En condition stressée avec déformation: On se place dans une situation dans laquelle la profondeur de marché est réduite à la suite d’un choc conduisant à un assèchement du marché.</p>
<div id="2c762014" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liqudity(df_volume, ADV_rate<span class="op">=</span><span class="fl">0.2</span>, weight_adjust<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">"Conditions normales avec déformation"</span>, seed <span class="op">=</span> <span class="dv">42</span>):</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Fonction de calcul de la liquidité d'un portefeuille sur plusieurs jours.</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Paramètres :</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="co">    df_volume : DataFrame</span></span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="co">        DataFrame contenant les volumes quotidiens pour chaque actif (tickers).</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ADV_rate : float, optionnel</span></span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Taux de liquidité journalière exprimé en pourcentage de l'ADV (par défaut 0.2, soit 20%).</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co">    weight_adjust : float, optionnel</span></span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Facteur de pondération pour ajuster la quantité générée aléatoirement (par défaut 1).</span></span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a><span class="co">    label : str, optionnel</span></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">        Label pour décrire le scénario de liquidation (par défaut "Conditions normales avec déformation").</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a><span class="co">    Retourne :</span></span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="co">    portfolio_liquidity : DataFrame</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="co">        DataFrame contenant les informations suivantes pour chaque actif :</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'Ticker' : Le symbole de l'actif.</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'ADV' : Le volume moyen quotidien calculé sur une fenêtre de 60 jours.</span></span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'Prix' : Le prix actuel de l'actif (extrait de df_close).</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'QUANTITE' : La quantité totale simulée de l'actif détenu par le portefeuille.</span></span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'QUANTITE LIQUIDABLE' : La quantité qui peut être liquidée quotidiennement (ADV_rate * ADV).</span></span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'NB_JOURS DE LIQUIDATION' : Nombre de jours estimés pour liquider entièrement l'actif.</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'JOUR X' (où X est un numéro de jour) : Quantité restante après chaque jour de liquidation.</span></span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="co">            - 'POIDS X' : Poids relatif de chaque actif dans le portefeuille après chaque jour de liquidation.</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">    Description :</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="co">    -------------</span></span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Calcul de l'Average Daily Volume (ADV) sur une fenêtre de 60 jours.</span></span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Création d'un DataFrame contenant les informations de liquidité de chaque actif.</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Génération de quantités d'actifs aléatoires pour simuler un portefeuille.</span></span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Calcul de la quantité liquidable par jour (20 % de l'ADV par défaut).</span></span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="co">    5. Simulation de la liquidation progressive de chaque actif jour par jour jusqu'à épuisement.</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a><span class="co">    6. Calcul des poids du portefeuille après chaque jour de liquidation.</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la moyenne mobile sur 60 jours du volume de transactions (ADV : Average Daily Volume)</span></span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>    ADV <span class="op">=</span> df_volume.rolling(window<span class="op">=</span><span class="dv">60</span>).mean()</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraction de l'ADV le plus récent pour chaque ticker</span></span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    latest_ADV <span class="op">=</span> ADV.iloc[<span class="op">-</span><span class="dv">1</span>,]</span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Création d'un DataFrame contenant l'ADV, le prix actuel et d'autres informations pour chaque actif</span></span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity <span class="op">=</span> pd.DataFrame({<span class="st">'Ticker'</span>: tickers, <span class="st">'ADV'</span>: latest_ADV.values, <span class="st">'Prix'</span>: df_close.iloc[<span class="op">-</span><span class="dv">1</span>,].values})</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>    <span class="co"># On définit la colonne 'Ticker' comme index pour faciliter l'accès aux données</span></span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity <span class="op">=</span> portfolio_liquidity.set_index(<span class="st">'Ticker'</span>)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Génération de quantités d'actifs simulées basées sur l'ADV</span></span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>    np.random.seed(seed)  <span class="co"># Pour des résultats reproductibles</span></span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">=</span> weight_adjust <span class="op">*</span> <span class="fl">1.5</span> <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>) <span class="op">*</span> portfolio_liquidity[<span class="st">'ADV'</span>]</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la quantité liquidable : 20 % de l'ADV (peut être ajusté via 'ADV_rate')</span></span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>] <span class="op">=</span> ADV_rate <span class="op">*</span> portfolio_liquidity[<span class="st">'ADV'</span>]</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul du nombre de jours nécessaires pour liquider chaque actif</span></span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'NB_JOURS DE LIQUIDATION'</span>] <span class="op">=</span> np.ceil(</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">/</span> portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>]</span>
<span id="cb39-61"><a href="#cb39-61" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-62"><a href="#cb39-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-63"><a href="#cb39-63" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation pour le jour 0</span></span>
<span id="cb39-64"><a href="#cb39-64" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb39-65"><a href="#cb39-65" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb39-66"><a href="#cb39-66" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb39-67"><a href="#cb39-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-68"><a href="#cb39-68" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la quantité restante après le premier jour de liquidation</span></span>
<span id="cb39-69"><a href="#cb39-69" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">-</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>].clip(upper<span class="op">=</span>portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>])</span>
<span id="cb39-70"><a href="#cb39-70" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb39-71"><a href="#cb39-71" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb39-72"><a href="#cb39-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-73"><a href="#cb39-73" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul itératif jusqu'à liquidation complète</span></span>
<span id="cb39-74"><a href="#cb39-74" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">max</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb39-75"><a href="#cb39-75" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb39-76"><a href="#cb39-76" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Calcul de la quantité restante après chaque jour supplémentaire</span></span>
<span id="cb39-77"><a href="#cb39-77" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (</span>
<span id="cb39-78"><a href="#cb39-78" aria-hidden="true" tabindex="-1"></a>            portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">-</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>].clip(upper<span class="op">=</span>portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>])</span>
<span id="cb39-79"><a href="#cb39-79" aria-hidden="true" tabindex="-1"></a>        ).clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb39-80"><a href="#cb39-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-81"><a href="#cb39-81" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Mise à jour des poids du portefeuille pour ce jour</span></span>
<span id="cb39-82"><a href="#cb39-82" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb39-83"><a href="#cb39-83" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb39-84"><a href="#cb39-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-85"><a href="#cb39-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> portfolio_liquidity</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="3e4be5e4" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liquidity_profile(portfolio_liquidity, label<span class="op">=</span><span class="st">"Profil d'écoulement en conditions normales avec déformation"</span>):</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Fonction qui génère un profil de liquidité d'un portefeuille en fonction du nombre de jours nécessaires pour liquider tous les actifs.</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Paramètres :</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co">    portfolio_liquidity : DataFrame</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Le DataFrame généré par la fonction liqudity() contenant les quantités restantes par jour pour chaque actif.</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co">    label : str, optionnel</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Titre du graphique affiché (par défaut "Profil de liquidité en conditions normales avec déformation").</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="co">    Description :</span></span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a><span class="co">    -------------</span></span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Calcule la quantité restante d'actifs pour chaque jour jusqu'à liquidation totale.</span></span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Calcule le profil de liquidité en pourcentage du portefeuille initial liquidé au fil du temps.</span></span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Génère deux graphiques :</span></span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="co">       - Profil de liquidité en pourcentage du portefeuille initial.</span></span>
<span id="cb40-18"><a href="#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="co">       - Évolution des poids des actifs au fil des jours.</span></span>
<span id="cb40-19"><a href="#cb40-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-20"><a href="#cb40-20" aria-hidden="true" tabindex="-1"></a><span class="co">    Retourne :</span></span>
<span id="cb40-21"><a href="#cb40-21" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb40-22"><a href="#cb40-22" aria-hidden="true" tabindex="-1"></a><span class="co">    Affiche deux graphiques côte à côte montrant la liquidation progressive et l'évolution des poids.</span></span>
<span id="cb40-23"><a href="#cb40-23" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb40-24"><a href="#cb40-24" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculer le profil de liquidité</span></span>
<span id="cb40-25"><a href="#cb40-25" aria-hidden="true" tabindex="-1"></a>    liquidity_profile <span class="op">=</span> [portfolio_liquidity[<span class="st">'QUANTITE'</span>]]</span>
<span id="cb40-26"><a href="#cb40-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="bu">int</span>(portfolio_liquidity[<span class="st">'NB_JOURS DE LIQUIDATION'</span>].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb40-27"><a href="#cb40-27" aria-hidden="true" tabindex="-1"></a>        liquidity_profile.append(portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>])</span>
<span id="cb40-28"><a href="#cb40-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-29"><a href="#cb40-29" aria-hidden="true" tabindex="-1"></a>    liquidity_profile <span class="op">=</span> pd.DataFrame(liquidity_profile)</span>
<span id="cb40-30"><a href="#cb40-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-31"><a href="#cb40-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculer le profil en pourcentage de liquidité restante</span></span>
<span id="cb40-32"><a href="#cb40-32" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> liquidity_profile <span class="op">@</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb40-33"><a href="#cb40-33" aria-hidden="true" tabindex="-1"></a>    portefeuille_valeur <span class="op">=</span> profile[<span class="st">'QUANTITE'</span>]  <span class="co"># Récupérer la valeur du portefeuille</span></span>
<span id="cb40-34"><a href="#cb40-34" aria-hidden="true" tabindex="-1"></a>    profile <span class="op">=</span> <span class="dv">100</span> <span class="op">-</span> profile[<span class="dv">1</span>:,] <span class="op">*</span> <span class="dv">100</span> <span class="op">/</span> portefeuille_valeur</span>
<span id="cb40-35"><a href="#cb40-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-36"><a href="#cb40-36" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Créer une figure avec deux sous-graphiques côte à côte</span></span>
<span id="cb40-37"><a href="#cb40-37" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">16</span>, <span class="dv">6</span>))  </span>
<span id="cb40-38"><a href="#cb40-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-39"><a href="#cb40-39" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Premier graphique : Profil de liquidité</span></span>
<span id="cb40-40"><a href="#cb40-40" aria-hidden="true" tabindex="-1"></a>    ax1 <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb40-41"><a href="#cb40-41" aria-hidden="true" tabindex="-1"></a>    profile.plot(ax<span class="op">=</span>ax1, marker<span class="op">=</span><span class="st">'o'</span>, legend<span class="op">=</span><span class="va">False</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb40-42"><a href="#cb40-42" aria-hidden="true" tabindex="-1"></a>    barplot <span class="op">=</span> profile.plot(kind<span class="op">=</span><span class="st">'bar'</span>, ax<span class="op">=</span>ax1, color<span class="op">=</span><span class="st">'skyblue'</span>, edgecolor<span class="op">=</span><span class="st">'black'</span>, alpha<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb40-43"><a href="#cb40-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-44"><a href="#cb40-44" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Affichage des valeurs sur les barres</span></span>
<span id="cb40-45"><a href="#cb40-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> bar <span class="kw">in</span> barplot.patches:</span>
<span id="cb40-46"><a href="#cb40-46" aria-hidden="true" tabindex="-1"></a>        value <span class="op">=</span> <span class="bu">round</span>(bar.get_height(), <span class="dv">2</span>)</span>
<span id="cb40-47"><a href="#cb40-47" aria-hidden="true" tabindex="-1"></a>        ax1.text(bar.get_x() <span class="op">+</span> bar.get_width() <span class="op">/</span> <span class="dv">2</span>, bar.get_height() <span class="op">+</span> <span class="fl">0.5</span>, <span class="ss">f"</span><span class="sc">{</span>value<span class="sc">}</span><span class="ss">"</span>,</span>
<span id="cb40-48"><a href="#cb40-48" aria-hidden="true" tabindex="-1"></a>                 ha<span class="op">=</span><span class="st">'center'</span>, va<span class="op">=</span><span class="st">'bottom'</span>, fontsize<span class="op">=</span><span class="dv">10</span>, color<span class="op">=</span><span class="st">'black'</span>)</span>
<span id="cb40-49"><a href="#cb40-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-50"><a href="#cb40-50" aria-hidden="true" tabindex="-1"></a>    ax1.set_title(<span class="ss">f"</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb40-51"><a href="#cb40-51" aria-hidden="true" tabindex="-1"></a>    ax1.set_xlabel(<span class="st">"Jours"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-52"><a href="#cb40-52" aria-hidden="true" tabindex="-1"></a>    ax1.set_ylabel(<span class="st">"Liquidité du portefeuille (%)"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-53"><a href="#cb40-53" aria-hidden="true" tabindex="-1"></a>    ax1.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-54"><a href="#cb40-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-55"><a href="#cb40-55" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Étiquette de valeur du portefeuille</span></span>
<span id="cb40-56"><a href="#cb40-56" aria-hidden="true" tabindex="-1"></a>    ax1.text(<span class="fl">0.95</span>, <span class="fl">0.05</span>, <span class="ss">f"Valeur portefeuille : </span><span class="sc">{</span><span class="bu">round</span>(portefeuille_valeur)<span class="sc">}</span><span class="ss"> euros"</span>,</span>
<span id="cb40-57"><a href="#cb40-57" aria-hidden="true" tabindex="-1"></a>             transform<span class="op">=</span>ax1.transAxes, fontsize<span class="op">=</span><span class="dv">12</span>, color<span class="op">=</span><span class="st">'red'</span>, ha<span class="op">=</span><span class="st">'right'</span>, va<span class="op">=</span><span class="st">'bottom'</span>,</span>
<span id="cb40-58"><a href="#cb40-58" aria-hidden="true" tabindex="-1"></a>             bbox<span class="op">=</span><span class="bu">dict</span>(boxstyle<span class="op">=</span><span class="st">"round"</span>, facecolor<span class="op">=</span><span class="st">"white"</span>, edgecolor<span class="op">=</span><span class="st">"red"</span>))</span>
<span id="cb40-59"><a href="#cb40-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-60"><a href="#cb40-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-61"><a href="#cb40-61" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Deuxième graphique : Évolution des poids</span></span>
<span id="cb40-62"><a href="#cb40-62" aria-hidden="true" tabindex="-1"></a>    ax2 <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb40-63"><a href="#cb40-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">int</span>(portfolio_liquidity[<span class="st">'NB_JOURS DE LIQUIDATION'</span>].<span class="bu">max</span>()) <span class="op">+</span> <span class="dv">1</span>):</span>
<span id="cb40-64"><a href="#cb40-64" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span> <span class="kw">in</span> portfolio_liquidity.columns:</span>
<span id="cb40-65"><a href="#cb40-65" aria-hidden="true" tabindex="-1"></a>            ax2.plot(portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>], label<span class="op">=</span><span class="ss">f'Jour </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb40-66"><a href="#cb40-66" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb40-67"><a href="#cb40-67" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="ss">f"Colonne 'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">' non trouvée."</span>)</span>
<span id="cb40-68"><a href="#cb40-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-69"><a href="#cb40-69" aria-hidden="true" tabindex="-1"></a>    ax2.set_title(<span class="st">"Évolution des Poids au Fil des Jours"</span>, fontsize<span class="op">=</span><span class="dv">14</span>)</span>
<span id="cb40-70"><a href="#cb40-70" aria-hidden="true" tabindex="-1"></a>    ax2.set_xlabel(<span class="st">"Index"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-71"><a href="#cb40-71" aria-hidden="true" tabindex="-1"></a>    ax2.set_ylabel(<span class="st">"Poids"</span>, fontsize<span class="op">=</span><span class="dv">12</span>)</span>
<span id="cb40-72"><a href="#cb40-72" aria-hidden="true" tabindex="-1"></a>    ax2.legend()</span>
<span id="cb40-73"><a href="#cb40-73" aria-hidden="true" tabindex="-1"></a>    ax2.grid(axis<span class="op">=</span><span class="st">'y'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb40-74"><a href="#cb40-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-75"><a href="#cb40-75" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Ajustement de l'affichage</span></span>
<span id="cb40-76"><a href="#cb40-76" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb40-77"><a href="#cb40-77" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="profil-découlement-avec-déformation" class="level3">
<h3 class="anchored" data-anchor-id="profil-découlement-avec-déformation">Profil d’écoulement avec déformation</h3>
<section id="profil-découlement-en-conditions-normales-avec-déformation" class="level4">
<h4 class="anchored" data-anchor-id="profil-découlement-en-conditions-normales-avec-déformation">Profil d’écoulement en conditions normales avec déformation</h4>
<div id="3a2d04b8" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity(df_volume)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-29-output-1.png" width="1527" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>Le portefeuille étudié est liquidable en 8 jours au minimum. Au premier jour seul 23.17% du portefeuille est liquidable et atteint les 73.54% au 4eme jour. On observe que les poids des actifs composant le portefeuille sont déformés au fil des jours. Il y a alors une concentration du portefeuille sur les actifs les moins liquides. Cette situation est domageable pour les investisseurs restant dans le fonds, car il faudra plus de temps pour honorer les engagements du fonds vis-à-vis d’eux en cas de rachat ce qui augmente leur exposition au <em>risque de liquidité.</em>.</p>
<p>Afin de protéger ces investisseurs, le régulateur impose aux gérants de fonds de fixer des <em>GATES</em> qui doivent obligatoirement être présentés dans leurs prospectus. Cela consiste à donner une option au gérant pour restreindre les rachats quotidien, à 5% du fonds par exemple.</p>
<hr>
</section>
<section id="profil-découlement-en-conditions-stressée-avec-déformation" class="level4">
<h4 class="anchored" data-anchor-id="profil-découlement-en-conditions-stressée-avec-déformation">Profil d’écoulement en conditions stressée avec déformation</h4>
<p>En conjoncture défavorable, la profondeur de marché est réduite ce qui entraîne un contraction des volumes liquidables. Nous simulons un tel choc en réduisant la profondeur de marché à 10% l’ADV.</p>
<div id="eaad1a03" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity(df_volume, ADV_rate<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-30-output-1.png" width="1527" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
<p>La contraction de la profondeur de marché rallonge la durée minimale de liquidation du fonds à 15 jours contre 8 jours initialement. Ceci illustre bien l’exposition du fonds au risque de liquidité. Il devient donc indispensable pour le gérant du fonds de déterminer une <em>taille optimale</em> de celui-ci afin de réduire son exposition au risque de liquidité.</p>
<hr>
</section>
<section id="taille-optimale-du-portefeuille" class="level4">
<h4 class="anchored" data-anchor-id="taille-optimale-du-portefeuille">Taille optimale du portefeuille</h4>
<hr>
<p>On peut ajuster la taille du portefeuille en faisant varier le paramètre <em>weight_adjust</em> de la fonction <em>liqudity</em> afin de déterminer la taille optimale du fonds liquidable en 1 jour.</p>
<p>Pour le cas étudié, le fonds optimal a une valeur de <strong>123 184 238</strong> euros dont 99.82% est liquidable en 1 jour.</p>
<div id="3ce57c94" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity(df_volume, weight_adjust<span class="op">=</span><span class="fl">0.141</span>) <span class="co"># Taille optimale du portefeuille</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity)</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la taille du portefeuille 123 184 238</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-31-output-1.png" width="1527" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En repétant le scénario défavorable d’un choc qui réduit la profondeur de marché à 10% l’ADV, le fonds optimal ainsi constitué est liquidable à 99.82% en deux jours. Il est donc plus résilient.</p>
<div id="30ec72c5" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity(df_volume, ADV_rate<span class="op">=</span><span class="fl">0.1</span>, weight_adjust<span class="op">=</span><span class="fl">0.141</span>) <span class="co"># Taille optimale du portefeuille</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Afficher la taille du portefeuille 123 184 238</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-32-output-1.png" width="1527" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="profil-découlement-sans-déformation" class="level3">
<h3 class="anchored" data-anchor-id="profil-découlement-sans-déformation">Profil d’écoulement sans déformation</h3>
<p>Rappelons qu’une politique de gestion sans déformation consiste à appliquer des rachats proformat. Ceci garantisse une stabilité de la composition du fonds.</p>
<div id="886055a7" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> liqudity_proformat(df_volume, ADV_rate <span class="op">=</span> <span class="fl">0.2</span>, weight_adjust <span class="op">=</span> <span class="dv">1</span>):</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="co">    Fonction qui génère un DataFrame décrivant la liquidité d'un portefeuille sur plusieurs jours, en fonction de la quantité disponible par jour et des poids correspondants.</span></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a><span class="co">    Paramètres :</span></span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="co">    -----------</span></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co">    df_volume : DataFrame</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a><span class="co">        Un DataFrame contenant les volumes quotidiens de chaque ticker.</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="co">    ADV_rate : float, optionnel</span></span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a><span class="co">        Le pourcentage d'Average Daily Volume (ADV) disponible chaque jour pour être liquidé (par défaut : 0.2, soit 20 %).</span></span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a><span class="co">    weight_adjust : float, optionnel</span></span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a><span class="co">        Facteur d'ajustement appliqué pour moduler la quantité calculée (par défaut : 1).</span></span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a><span class="co">    Description :</span></span>
<span id="cb45-15"><a href="#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="co">    -------------</span></span>
<span id="cb45-16"><a href="#cb45-16" aria-hidden="true" tabindex="-1"></a><span class="co">    1. Calcule l'ADV (volume moyen sur 60 jours) pour chaque actif.</span></span>
<span id="cb45-17"><a href="#cb45-17" aria-hidden="true" tabindex="-1"></a><span class="co">    2. Génère un DataFrame contenant l'ADV, les prix actuels, les quantités à liquider, et les quantités liquidables par jour.</span></span>
<span id="cb45-18"><a href="#cb45-18" aria-hidden="true" tabindex="-1"></a><span class="co">    3. Calcule le nombre de jours nécessaire pour liquider complètement chaque actif.</span></span>
<span id="cb45-19"><a href="#cb45-19" aria-hidden="true" tabindex="-1"></a><span class="co">    4. Produit une série de DataFrames pour chaque jour, montrant la quantité restante, les poids associés, et les vitesses de liquidation.</span></span>
<span id="cb45-20"><a href="#cb45-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-21"><a href="#cb45-21" aria-hidden="true" tabindex="-1"></a><span class="co">    Retourne :</span></span>
<span id="cb45-22"><a href="#cb45-22" aria-hidden="true" tabindex="-1"></a><span class="co">    ---------</span></span>
<span id="cb45-23"><a href="#cb45-23" aria-hidden="true" tabindex="-1"></a><span class="co">    portfolio_liquidity : DataFrame</span></span>
<span id="cb45-24"><a href="#cb45-24" aria-hidden="true" tabindex="-1"></a><span class="co">        Un DataFrame contenant les informations de liquidité du portefeuille sur plusieurs jours.</span></span>
<span id="cb45-25"><a href="#cb45-25" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb45-26"><a href="#cb45-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la moyenne mobile du volume (ADV) sur une fenêtre de 60 jours</span></span>
<span id="cb45-27"><a href="#cb45-27" aria-hidden="true" tabindex="-1"></a>    ADV <span class="op">=</span> df_volume.rolling(window<span class="op">=</span><span class="dv">60</span>).mean()</span>
<span id="cb45-28"><a href="#cb45-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-29"><a href="#cb45-29" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Extraction de la dernière ligne (les valeurs ADV les plus récentes)</span></span>
<span id="cb45-30"><a href="#cb45-30" aria-hidden="true" tabindex="-1"></a>    latest_ADV <span class="op">=</span> ADV.iloc[<span class="op">-</span><span class="dv">1</span>,]</span>
<span id="cb45-31"><a href="#cb45-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-32"><a href="#cb45-32" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Création d'un DataFrame pour la liquidité du portefeuille</span></span>
<span id="cb45-33"><a href="#cb45-33" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity <span class="op">=</span> pd.DataFrame({<span class="st">'Ticker'</span>: tickers, <span class="st">'ADV'</span>: latest_ADV.values, <span class="st">'Prix'</span>: df_close.iloc[<span class="op">-</span><span class="dv">1</span>,].values})</span>
<span id="cb45-34"><a href="#cb45-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-35"><a href="#cb45-35" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Définir 'Ticker' comme index pour un accès plus facile</span></span>
<span id="cb45-36"><a href="#cb45-36" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity <span class="op">=</span> portfolio_liquidity.set_index(<span class="st">'Ticker'</span>)</span>
<span id="cb45-37"><a href="#cb45-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-38"><a href="#cb45-38" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la quantité (QUANTITE) basée sur le volume le plus récent</span></span>
<span id="cb45-39"><a href="#cb45-39" aria-hidden="true" tabindex="-1"></a>    np.random.seed(<span class="dv">42</span>)</span>
<span id="cb45-40"><a href="#cb45-40" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">=</span> weight_adjust <span class="op">*</span> <span class="fl">1.5</span> <span class="op">*</span> np.random.uniform(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">10</span>) <span class="op">*</span> portfolio_liquidity[<span class="st">'ADV'</span>]</span>
<span id="cb45-41"><a href="#cb45-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-42"><a href="#cb45-42" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul de la quantité liquidable par jour</span></span>
<span id="cb45-43"><a href="#cb45-43" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>] <span class="op">=</span> ADV_rate <span class="op">*</span> portfolio_liquidity[<span class="st">'ADV'</span>]</span>
<span id="cb45-44"><a href="#cb45-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-45"><a href="#cb45-45" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calcul du nombre de jours de liquidation nécessaire</span></span>
<span id="cb45-46"><a href="#cb45-46" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="st">'NB_JOURS DE LIQUIDATION'</span>] <span class="op">=</span> np.ceil(portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">/</span> portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>])</span>
<span id="cb45-47"><a href="#cb45-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-48"><a href="#cb45-48" aria-hidden="true" tabindex="-1"></a>    i <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb45-49"><a href="#cb45-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Initialisation du premier jour</span></span>
<span id="cb45-50"><a href="#cb45-50" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb45-51"><a href="#cb45-51" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span><span class="dv">0</span><span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb45-52"><a href="#cb45-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-53"><a href="#cb45-53" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>] <span class="op">-</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>].clip(upper<span class="op">=</span>portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>])</span>
<span id="cb45-54"><a href="#cb45-54" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb45-55"><a href="#cb45-55" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb45-56"><a href="#cb45-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-57"><a href="#cb45-57" aria-hidden="true" tabindex="-1"></a>    portfolio_liquidity[<span class="ss">f'SPEED </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>].clip(upper<span class="op">=</span>portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>]) <span class="op">/</span> portfolio_liquidity[<span class="st">'QUANTITE'</span>]</span>
<span id="cb45-58"><a href="#cb45-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-59"><a href="#cb45-59" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">max</span>() <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb45-60"><a href="#cb45-60" aria-hidden="true" tabindex="-1"></a>        i <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb45-61"><a href="#cb45-61" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> (</span>
<span id="cb45-62"><a href="#cb45-62" aria-hidden="true" tabindex="-1"></a>            (portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">-</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>] <span class="op">*</span> portfolio_liquidity[<span class="ss">f'SPEED </span><span class="sc">{</span>i<span class="op">-</span><span class="dv">1</span><span class="sc">}</span><span class="ss">'</span>].<span class="bu">min</span>())</span>
<span id="cb45-63"><a href="#cb45-63" aria-hidden="true" tabindex="-1"></a>        ).clip(lower<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb45-64"><a href="#cb45-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-65"><a href="#cb45-65" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">*</span> portfolio_liquidity[<span class="st">'Prix'</span>]</span>
<span id="cb45-66"><a href="#cb45-66" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">/</span> portfolio_liquidity[<span class="ss">f'POIDS </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].<span class="bu">sum</span>()</span>
<span id="cb45-67"><a href="#cb45-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-68"><a href="#cb45-68" aria-hidden="true" tabindex="-1"></a>        portfolio_liquidity[<span class="ss">f'SPEED </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>] <span class="op">=</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>].clip(upper<span class="op">=</span>portfolio_liquidity[<span class="st">'QUANTITE LIQUIDABLE'</span>]) <span class="op">/</span> portfolio_liquidity[<span class="ss">f'JOUR </span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">'</span>]</span>
<span id="cb45-69"><a href="#cb45-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-70"><a href="#cb45-70" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> portfolio_liquidity</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="profil-découlement-en-conditions-normales-sans-déformation" class="level4">
<h4 class="anchored" data-anchor-id="profil-découlement-en-conditions-normales-sans-déformation">Profil d’écoulement en conditions normales sans déformation</h4>
<div id="9496d7b8" class="cell" data-execution_count="33">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity_proformat(df_volume)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity, label<span class="op">=</span><span class="st">"Profil d'écoulement en conditions normales sans déformation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-34-output-1.png" width="1527" height="567" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les actions sont liquidées à la vitesse de l’actif le moins liquide du portefeuille. Par conséquent, contrairement à un écoulement avec déformation, la quantité liquidable progresse plus lentement dans le temps. Par exemple, on observe qu’en quatre jours seuls 59,01 % du fonds peuvent être liquidés, contre 73,54 % dans un scénario avec déformation.</p>
<p>Par ailleurs, les poids des différents actifs restent globalement stables au fil des jours, à l’exception du dernier jour où l’intégralité du fonds est liquidée. Cette stabilité implique qu’il n’y a pas de concentration progressive du risque de liquidité sur les actifs les moins liquides, ce qui constitue une caractéristique importante du mécanisme d’écoulement sans déformation.</p>
</section>
<section id="profil-découlement-en-conditions-stressée-sans-déformation" class="level4">
<h4 class="anchored" data-anchor-id="profil-découlement-en-conditions-stressée-sans-déformation">Profil d’écoulement en conditions stressée sans déformation</h4>
<div id="1ba4e454" class="cell" data-execution_count="34">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>portfolio_liquidity <span class="op">=</span> liqudity_proformat(df_volume, ADV_rate<span class="op">=</span><span class="fl">0.1</span>)</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>liquidity_profile(portfolio_liquidity, label<span class="op">=</span><span class="st">"Profil d'écoulement en conditions stressée sans déformation"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-35-output-1.png" width="1527" height="566" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Un choc sur la profondeur de marché a pour effet un rallongement de la durée minimale de liquidation du fonds. Toutefois, les poids restent bien stables.</p>
</section>
</section>
</section>
<section id="ii.-risque-de-crédit-et-risque-de-taux" class="level2">
<h2 class="anchored" data-anchor-id="ii.-risque-de-crédit-et-risque-de-taux">II. Risque de crédit et risque de taux</h2>
<p>Le <strong>risque de crédit</strong> est le risque de perte engendrée par la defaillance d’une partie prenante à remplir ses engagements contractuels préalablement établis. C’est principal risque observé sur périmètre du retail.</p>
<p>On définit le <strong>taux d’intérêt</strong> comme <strong>le loyer de l’argent (annualisé dans la pratique)</strong>.</p>
<p>Cette définition est celle historique car très intuitive. Il peut cependant s’averer que les taux d’interêt soient négatifs. Là cette definition devient donc limitée.</p>
<p>Depéndamment de ce qu’on fait de son argent, le thésauriser, le prêter à la banque , ou encore à l’etat, il existe toujours un risque de perte qui subsiste. Il peut donc advenir, que dans le souci de sécuriser son argent, dans un contexte particulier (notamment incertain), le posseusseur soit disposé à payer pour securiser son argent : on parle de taux d’intérêt négatif.</p>
<p>Cela illustre la métaphore du <strong>loyer du coffre fort</strong>.</p>
<section id="généralités-sur-le-pricing-dobligations" class="level3">
<h3 class="anchored" data-anchor-id="généralités-sur-le-pricing-dobligations">Généralités sur le pricing d’obligations</h3>
<p>CONTEXTE</p>
<p>En raison des obligations réglementaires auxquelles les banques sont soumises, elles ne peuvent pas prêter à toutes les entreprises ayant besoin de financement. C’est dans ce contexte que la notion d’obligation prend son sens. La banque agit alors en tant qu’intermédiaire entre l’entreprise et le marché, et perçoit des frais de commission. le marché prête un montant M à l’entreprise et reçoit des annuités et le nominal à maturité.</p>
<p>Une <strong>obligation</strong> est, économiquement, un prêt-emprunt.</p>
<p>De manière générale, la valorisation d’un actif est l’espérance des flux actualisés au taux sans risque sous la probabilité risque neutre :</p>
<p><span class="math display">\[
\begin{aligned}
X_0 &amp;= \mathbb{E}[e^{-rT} X_T] \\
    &amp;= e^{-rT} \, c \times PS(T)
\end{aligned}
\]</span></p>
<p><strong>N.B</strong> : <em>Le taux de recouvrement historique est de 40 %</em>.<br>
Le recouvrement s’applique uniquement au nominal.</p>
<p>La probabilité de survie <span class="math inline">\(PS(T)\)</span> est généralement déterminée à partir du modèle à intensité de Poisson via :</p>
<p><span class="math display">\[
PS(T) = e^{-\lambda T}
\]</span></p>
<p>Considérons une obligation d’échéances <span class="math inline">\(T_i\)</span>, <span class="math inline">\(i = 1, \dots, n\)</span>, de coupon <span class="math inline">\(c\)</span> et de nominal <span class="math inline">\(N\)</span>.<br>
Les coupons et le nominal sont payés en cas de survie, et le recouvrement en cas de défaut.</p>
<p>La valeur de cette obligation à la date <span class="math inline">\(t\)</span> vaut :</p>
<p><span class="math display">\[
C_t = \sum_{i=1}^{n} c \, e^{-(\lambda+r)(T_i - t)} \mathbf{1}_{\{T_i \ge t\}}
\]</span></p>
<p>La probabilité de survenue du défaut à une date <span class="math inline">\(t\)</span> vaut :</p>
<p><span class="math display">\[
\begin{aligned}
PD(t)
    &amp;= PS(t) - PS(t + dt) \\
    &amp;= -\frac{PS(t+dt) - PS(t)}{dt} \, dt \\
    &amp;= -\frac{dPS(t)}{dt} \, dt \\
    &amp;= \lambda e^{-\lambda t} \, dt
\end{aligned}
\]</span></p>
<p>La valeur actualisée du recouvrement vaut :</p>
<p><span class="math display">\[
\mathcal{R}_0
= \int_0^T R \lambda e^{-\lambda t} e^{-rt} \, dt
= \lambda R \, \frac{1 - e^{-(r+\lambda)T}}{r+\lambda}
\]</span></p>
<p>De manière générale, pour une date <span class="math inline">\(t\)</span> :</p>
<p><span class="math display">\[
\mathcal{R}_t
= \int_t^T R \lambda e^{-\lambda u} e^{-ru} \, du
= \lambda R \, e^{(r+\lambda)t}
  \frac{1 - e^{-(r+\lambda)T}}{r+\lambda}
  \mathbf{1}_{\{T \ge t\}}
\]</span></p>
<p>La valeur totale de l’obligation est alors :</p>
<p><span class="math display">\[
\begin{aligned}
B_t
&amp;= \sum_{i=1}^{n}
    c \, e^{-(\lambda+r)(T_i - t)} \mathbf{1}_{\{T_i \ge t\}} \\
&amp;\quad +
\left(
e^{-(r+\lambda)(T_n - t)}
+
\lambda R \, e^{(r+\lambda)t}
\frac{1 - e^{-(r+\lambda)T_n}}{r+\lambda}
\right)
\mathbf{1}_{\{T_n \ge t\}}
\end{aligned}
\]</span></p>
</section>
<section id="impementation-de-la-valorisation-dun-bond" class="level3">
<h3 class="anchored" data-anchor-id="impementation-de-la-valorisation-dun-bond">Impementation de la valorisation d’un bond</h3>
<div id="7354af8e" class="cell" data-execution_count="35">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Impementation de la fonctiuon de valorisation d'un bond</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Bond(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>):</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>    B <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> T_i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>,T<span class="op">+</span><span class="dv">1</span>):</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>        B <span class="op">+=</span> np.exp(<span class="op">-</span>(lamda <span class="op">+</span> r)<span class="op">*</span>(T_i <span class="op">-</span> t))<span class="op">*</span>(T_i<span class="op">&gt;=</span>t)</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>    B <span class="op">*=</span> c</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>    B <span class="op">+=</span> (np.exp(<span class="op">-</span>(r <span class="op">+</span> lamda)<span class="op">*</span>(T_i<span class="op">-</span>t)) <span class="op">+</span> lamda <span class="op">*</span> R  <span class="op">*</span> (<span class="dv">1</span><span class="op">-</span>(np.exp(<span class="op">-</span>(r <span class="op">+</span> lamda)<span class="op">*</span>(T_i <span class="op">-</span>t)))) <span class="op">/</span> (r <span class="op">+</span> lamda))<span class="op">*</span>(T_i<span class="op">&gt;=</span>t)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> B</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<section id="exemple-obligation-au-pair" class="level4">
<h4 class="anchored" data-anchor-id="exemple-obligation-au-pair">Exemple: Obligation au pair</h4>
<section id="lamda-0" class="level5">
<h5 class="anchored" data-anchor-id="lamda-0">lamda = 0</h5>
</section>
<section id="r-0.02" class="level5">
<h5 class="anchored" data-anchor-id="r-0.02">r = 0.02</h5>
</section>
<section id="c-0.02" class="level5">
<h5 class="anchored" data-anchor-id="c-0.02">c = 0.02</h5>
</section>
<section id="t-0" class="level5">
<h5 class="anchored" data-anchor-id="t-0">t = 0</h5>
</section>
<section id="t-10" class="level5">
<h5 class="anchored" data-anchor-id="t-10">T = 10</h5>
</section>
<section id="bondtctrlamda" class="level5">
<h5 class="anchored" data-anchor-id="bondtctrlamda">Bond(t,c,T,r,lamda)</h5>
<div id="ac05c09a" class="cell" data-execution_count="36">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Exemple1: Obligation au pair</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>Bond(t,c,T,r,lamda)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="36">
<pre><code>np.float64(0.9981933497987289)</code></pre>
</div>
</div>
<p>Avec les paramètres ci-dessus considérés, on remarque que le prix de l’obligation est proche du nominal. En effet, le taux coupon est égal au taux de marché, ce qui indique que l’obligation est remunérée au taux du marché. Il s’agit donc d’une obligation au pair.</p>
<p>Au cas où on aurait proposé une remunération supérieure à celle du marché, elle serait beaucoup plus attractive et sa valeur se serait appréciée. l’illustration est donnée ci dessous pour c= 0.03</p>
</section>
<section id="bond00.03100.020" class="level5">
<h5 class="anchored" data-anchor-id="bond00.03100.020">Bond(0,0.03,10,0.02,0)</h5>
<div id="08ce8209" class="cell" data-execution_count="37">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> Bond(<span class="dv">0</span>,<span class="fl">0.03</span>,<span class="dv">10</span>,<span class="fl">0.02</span>,<span class="dv">0</span>)</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>price</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>np.float64(1.0879246481591023)</code></pre>
</div>
</div>
<p>Avec une remunération inférieure à ce qu’aurait proposé le marché, on obtient une valorisation de l’obligation inférieure au nomimal</p>
</section>
<section id="bond00.015100.020" class="level5">
<h5 class="anchored" data-anchor-id="bond00.015100.020">Bond(0,0.015,10,0.02,0)</h5>
<div id="7dae4002" class="cell" data-execution_count="38">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>price <span class="op">=</span> Bond(<span class="dv">0</span>,<span class="fl">0.015</span>,<span class="dv">10</span>,<span class="fl">0.02</span>,<span class="dv">0</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>price</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="38">
<pre><code>np.float64(0.9533277006185421)</code></pre>
</div>
</div>
<p>Etant donné une intensité de défaut supérieure à zéro, on peut également calculer le coupon pour lequel l’obligation est au pair. On obtient, après calculs prsentés ci-dessous, un taux coupon de 2.6%.</p>
<div id="a291989c" class="cell" data-execution_count="39">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Recherche du coupon  pour émettre une obligation au pair.</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> dichot(t,T,r,lamda, P_MKT):</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    c_inf <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>    c_sup <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    epsi <span class="op">=</span> <span class="fl">1e-8</span></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>    c_moy <span class="op">=</span> (c_inf <span class="op">+</span> c_sup)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>    error <span class="op">=</span> c_sup <span class="op">-</span> c_inf</span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> error<span class="op">&gt;</span>epsi:</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>        p_hw <span class="op">=</span> Bond(t,c_moy,T,r,lamda)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> p_hw <span class="op">&gt;</span> P_MKT:</span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>            c_sup <span class="op">=</span> c_moy</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> p_hw <span class="op">&lt;</span> P_MKT:</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>            c_inf <span class="op">=</span> c_moy</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>        c_moy <span class="op">=</span> (c_inf <span class="op">+</span> c_sup)<span class="op">/</span><span class="dv">2</span></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>        error <span class="op">=</span> np.<span class="bu">abs</span>(c_sup <span class="op">-</span> c_inf)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> c_moy</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
</section>
<section id="taux-coupon-pour-émettre-une-obligation-au-pair" class="level4">
<h4 class="anchored" data-anchor-id="taux-coupon-pour-émettre-une-obligation-au-pair">Taux coupon pour émettre une obligation au pair</h4>
<section id="lamda-0.01" class="level5">
<h5 class="anchored" data-anchor-id="lamda-0.01">lamda = 0.01</h5>
</section>
<section id="r-0.02-1" class="level5">
<h5 class="anchored" data-anchor-id="r-0.02-1">r = 0.02</h5>
</section>
<section id="t-0-1" class="level5">
<h5 class="anchored" data-anchor-id="t-0-1">t = 0</h5>
</section>
<section id="t-10-1" class="level5">
<h5 class="anchored" data-anchor-id="t-10-1">T = 10</h5>
<div id="98af0eb8" class="cell" data-execution_count="40">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Taux coupon pour émettre une obligation au pair</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>dichot(t,T,r,lamda, P_MKT <span class="op">=</span> <span class="dv">1</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<pre><code>0.026393926193952293</code></pre>
</div>
</div>
<p>En maintenant une remunération égale à celle du marché , avec une intensité de défaut très grande (de l’ordre de 1000%), l’obligation tombe presque instantannément en défaut. Dans cette situation, la valeur du coupon vaut alors 39.92% qui est sensiblement proche du taux de recouvrement (40%).</p>
</section>
</section>
<section id="valeur-du-bond-poiur-une-intensité-de-défaut-à-1000" class="level4">
<h4 class="anchored" data-anchor-id="valeur-du-bond-poiur-une-intensité-de-défaut-à-1000">Valeur du bond poiur une intensité de défaut à 1000%</h4>
<div id="2939a4c5" class="cell" data-execution_count="41">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur du bond poiur une intensité de défaut à 1000%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>Bond(t,c,T,r,lamda)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<pre><code>np.float64(0.39920293189432754)</code></pre>
</div>
</div>
</section>
</section>
<section id="évolution-du-prix-de-lobligation-en-fonction-du-temps" class="level3">
<h3 class="anchored" data-anchor-id="évolution-du-prix-de-lobligation-en-fonction-du-temps">Évolution du prix de l’obligation en fonction du temps</h3>
<div id="9c9eef4a" class="cell" data-execution_count="42">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">10</span>, num <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>B <span class="op">=</span> np.array([Bond(t,c,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Temps"</span>)</span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Prix du Bond (%)"</span>)</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Evolution du prix plein coupon du Bond"</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-43-output-1.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Plus on se rapproche de la date de détachement du coupon plus l’obligation devient attractive, elle prend donc de la valeur.</p>
<p>Chaque saut correspond à un détachement de coupons. une fois le coupon détaché de l’obligation, les flux à venir diminuent et la valeur de l’obligation se deprecie de la valeur du coupon qui a été détaché.</p>
<p>Ces sauts ne reflètent donc pas une dépréciation des bonds par le marché. Ce sont des sauts techniques. Raison pour laquelle on dit que le prix plein coupon est pollué par le coupon (en anglais <strong>Dirty price</strong>).</p>
<p>On va donc s’interesser par la suite au <strong>clean price</strong> ou <strong>pied de coupon</strong> qui correspond à au prix du bond moins le coupon couru.</p>
<p><span class="math display">\[
\tilde{B}_t = B_t - cc
\]</span></p>
<p>Où (cc) est le coupon couru :</p>
<p><span class="math display">\[
cc = c \times (t - T^*)
\]</span></p>
<p>En retirant cette valeur de coupon couru, on supprime cet effet de saut après les detachements de coupons</p>
<section id="implémentation-du-clean-price" class="level4">
<h4 class="anchored" data-anchor-id="implémentation-du-clean-price">Implémentation du clean price</h4>
<div id="f0e913d9" class="cell" data-execution_count="43">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Implémentation du clean price</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> CleanPrice(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>):</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>    cc <span class="op">=</span> c<span class="op">*</span>(t <span class="op">-</span> np.floor(t))<span class="op">*</span>(t<span class="op">&lt;=</span>T)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> Bond(t,c,T,r,lamda, R)<span class="op">-</span>cc</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="pieds-coupon" class="level4">
<h4 class="anchored" data-anchor-id="pieds-coupon">Pieds coupon</h4>
<div id="2fbab589" class="cell" data-execution_count="44">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Pieds coupon</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">10</span>, num <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>B_plein_coupon <span class="op">=</span> np.array([Bond(t,c,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a>B_pieds_coupon <span class="op">=</span> np.array([CleanPrice(t,c,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_pieds_coupon, label <span class="op">=</span><span class="st">"Pieds coupon"</span>)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_plein_coupon, label <span class="op">=</span><span class="st">"Plein coupon"</span>)</span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Temps"</span>)</span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Prix du Bond (%)"</span>)</span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Evolution du prix du Bond"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="44">
<pre><code>Text(0.5, 1.0, 'Evolution du prix du Bond')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-45-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>En retirant cette valeur de coupon couru, on supprime l’effet de saut après les detachements de coupons, et on observe une courbe sans discontinuités</p>
</section>
</section>
<section id="evolution-du-prix-plein-coupon-et-du-clean-price-en-fonction-du-temps-pour-differents-coupons" class="level3">
<h3 class="anchored" data-anchor-id="evolution-du-prix-plein-coupon-et-du-clean-price-en-fonction-du-temps-pour-differents-coupons">Evolution du prix plein coupon et du clean price en fonction du temps pour differents coupons</h3>
<div id="9c2bc3bf" class="cell" data-execution_count="45">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>times <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">10</span>, num <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>B_plein_coupon1 <span class="op">=</span> np.array([Bond(t,<span class="fl">0.01</span>,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>B_pieds_coupon1 <span class="op">=</span> np.array([CleanPrice(t,<span class="fl">0.01</span>,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a>B_plein_coupon5 <span class="op">=</span> np.array([Bond(t,<span class="fl">0.05</span>,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>B_pieds_coupon5 <span class="op">=</span> np.array([CleanPrice(t,<span class="fl">0.05</span>,T,r,lamda) <span class="cf">for</span> t <span class="kw">in</span> times])</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_pieds_coupon1, label <span class="op">=</span><span class="st">"Pieds coupon 1%"</span>)</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_plein_coupon1, label <span class="op">=</span><span class="st">"Plein coupon 1%"</span>)</span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_pieds_coupon5, label <span class="op">=</span><span class="st">"Pieds coupon 5%"</span>)</span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>plt.plot(times,B_plein_coupon5, label <span class="op">=</span><span class="st">"Plein coupon 5%"</span>)</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Temps"</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Prix du Bond (%)"</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Evolution du prix du Bond"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<pre><code>Text(0.5, 1.0, 'Evolution du prix du Bond')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-46-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Les constats que l’on fait : - Lorsque c = 1% : La rémunération de l’obligation est inférieure à celle offerte par le marché. Ainsi, lors de son émission, sa valeur sera nécessairement inférieure à celle du pair, ce qui explique une valeur initiale proche de 87 %. À maturité, on reçoit 100 % du nominal, plus 1 % de ce dernier, correspondant au coupon. Le résultat final est donc sensiblement égal à 101 %.</p>
<ul>
<li>Lorsque c = 5% : L’obligation rémunère plus que ce que le marché offre, ce qui la rend particulièrement attractive dès son émission. Ainsi, sa valeur de départ sera d’environ 120 %. Au fur et à mesure que les obligations sont détachées, les flux futurs diminuent, ce qui entraîne une dépréciation de sa valeur. À maturité, on reçoit 100 % du nominal, plus 5 % du montant nominal, correspondant au coupon. Le résultat final est donc de 105 %.</li>
</ul>
</section>
<section id="evolution-du-prix-de-lobligation-en-fonction-du-taux-dintérêt" class="level3">
<h3 class="anchored" data-anchor-id="evolution-du-prix-de-lobligation-en-fonction-du-taux-dintérêt">Evolution du prix de l’obligation en fonction du taux d’intérêt</h3>
<p>De l’expression analytique du prix du bond, on observe que le prix est décroissant du taux d’intérêt. La figure ci-dessous en donne une illustration, toute chose égale par ailleurs.</p>
<p>On vérifie graphiquement que le prix du bond est de 100% lorsque le taux d’intérêt est égal au taux sans risque <span class="math inline">\(r^* = c - \lambda (1 - R)\)</span>.</p>
<section id="evolution-du-prix-du-bond-en-fonction-du-taux-dintérêt" class="level5">
<h5 class="anchored" data-anchor-id="evolution-du-prix-du-bond-en-fonction-du-taux-dintérêt">Evolution du prix du bond en fonction du taux d’intérêt</h5>
<div id="a9a9bddf" class="cell" data-execution_count="46">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evolution du prix du bond en fonction du taux d'intérêt</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span> <span class="fl">0.4</span></span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>interest <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="fl">0.10</span>, num <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>B_plein_coupon <span class="op">=</span> np.array([Bond(t,c,T,r,lamda) <span class="cf">for</span> r <span class="kw">in</span> interest])</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>plt.plot(interest,B_plein_coupon, label <span class="op">=</span><span class="st">"Plein coupon"</span>)</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span>(c <span class="op">-</span> lamda<span class="op">*</span>(<span class="dv">1</span> <span class="op">-</span> R) ), color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'Taux sans risque $r^* = c - </span><span class="er">\</span><span class="st">lambda (1 - R) $'</span>)</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Taux d'intérêt (%)"</span>)</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Prix du Bond (%)"</span>)</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Evolution du prix du Bond en fonction du taux d'intérêt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stderr">
<pre><code>&lt;&gt;:12: SyntaxWarning: "\l" is an invalid escape sequence. Such sequences will not work in the future. Did you mean "\\l"? A raw string is also an option.
&lt;&gt;:12: SyntaxWarning: "\l" is an invalid escape sequence. Such sequences will not work in the future. Did you mean "\\l"? A raw string is also an option.
C:\Users\mokom\AppData\Local\Temp\ipykernel_32588\2938139823.py:12: SyntaxWarning: "\l" is an invalid escape sequence. Such sequences will not work in the future. Did you mean "\\l"? A raw string is also an option.
  plt.axvline(x=(c - lamda*(1 - R) ), color='red', linestyle='--', label='Taux sans risque $r^* = c - \lambda (1 - R) $')</code></pre>
</div>
<div class="cell-output cell-output-display" data-execution_count="46">
<pre><code>Text(0.5, 1.0, "Evolution du prix du Bond en fonction du taux d'intérêt")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-47-output-3.png" width="589" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="notion-de-sensibilité" class="level3">
<h3 class="anchored" data-anchor-id="notion-de-sensibilité">Notion de sensibilité</h3>
<p>La sensibilité mesure la variation du prix du bond face à une variation d’un facteur de risque. On distingue entre autres la sensibilité de taux et la sensibilité de crédit.</p>
<p>Dans cette sectioin nous nous intéressons particulièrement à la sensibilité de taux. Elle est définie par la formule:</p>
<p><span class="math display">\[
    Sensibilité = - \frac{dB_t}{dr} \frac{1}{B_t}
\]</span></p>
<p><strong>Interprétation</strong>: Lorsque le taux d’intérêt bouge de 1%, alors le prix du bond bouge de -sensibilité %.</p>
<p>Cette sensibilité peut également être vue comme le barycentre des différentes échéances pondérées par les flux actualisés. C’est <strong>la duration.</strong></p>
<p><span class="math display">\[
    \frac{\sum T_i\times F_i}{\sum F_i}
\]</span></p>
<p>Exemple: En considérant une obligation de maturité 3 ans payant des coupons annuels, avec intensité de défaut nul. Alors son prix et la sensibilité de taux sont données par:</p>
<p><span class="math display">\[
\begin{aligned}
P &amp;= c \, e^{-1r} + c \, e^{-2r} + c \, e^{-3r}
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\frac{\partial P}{\partial r}
&amp;= -1c \, e^{-1r} - 2c \, e^{-2r} - 3c \, e^{-3r}
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
\text{Sensibilité}
&amp;= \frac{1c \, e^{-1r} + 2c \, e^{-2r} + 3c \, e^{-3r}}
        {c \, e^{-1r} + c \, e^{-2r} + c \, e^{-3r}}
\end{aligned}
\]</span></p>
<p><strong>D’où l’expression barycentrique des échéances pondérées par les flux.</strong></p>
<div id="1fb19582" class="cell" data-execution_count="47">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilité de taux du prix du bond</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>delta_r <span class="op">=</span> <span class="fl">1e-4</span> <span class="co">#1bp</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Sensi(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, delta_r <span class="op">=</span> <span class="fl">1e-4</span>):</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>    B_t <span class="op">=</span> Bond(t,c,T,r,lamda, R)</span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>(Bond(t,c,T,r<span class="op">+</span>delta_r,lamda, R)<span class="op">-</span>B_t)<span class="op">/</span>(delta_r<span class="op">*</span>B_t)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>On considère un bond dont les caractérisiques sont les suivqantes:</p>
<p><span class="math display">\[
    \begin{cases}
        \lambda = 0.01\\
        r = 0.02\\
        c = 0.03\\
        T = 10\\
        R = 0.4\\
    \end{cases}
\]</span></p>
<p>La sensiblité de ce bond est de 8.64. Ainsi, lorsque le taux d’intérêt augmente de 1 point de pourcentage, le prix du bond diminue de 8.64%.</p>
<div id="7c3cc2e6" class="cell" data-execution_count="48">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilité de taux d'intérêt</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>Sensi(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, delta_r <span class="op">=</span> <span class="fl">1e-4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<pre><code>np.float64(8.643982489105056)</code></pre>
</div>
</div>
<section id="evolution-de-la-sensibilité-de-taux-fonction-de-la-maturité" class="level4">
<h4 class="anchored" data-anchor-id="evolution-de-la-sensibilité-de-taux-fonction-de-la-maturité">Evolution de la sensibilité de taux fonction de la maturité</h4>
<div id="6ec8137f" class="cell" data-execution_count="49">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evolution de la sensibilité au taux d'intérêt en fonction de la maturité</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a>maturity <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">21</span>)</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a>censi <span class="op">=</span> np.array([Sensi(t,c,T,r,lamda) <span class="cf">for</span> T <span class="kw">in</span> maturity])</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb72-5"><a href="#cb72-5" aria-hidden="true" tabindex="-1"></a>plt.plot(maturity, censi, label <span class="op">=</span><span class="st">"Duration"</span>)</span>
<span id="cb72-6"><a href="#cb72-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Maturité (année)"</span>)</span>
<span id="cb72-7"><a href="#cb72-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Duration"</span>)</span>
<span id="cb72-8"><a href="#cb72-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb72-9"><a href="#cb72-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Sensibilité du prix du bond en fonction de la maturité"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<pre><code>Text(0.5, 1.0, 'Sensibilité du prix du bond en fonction de la maturité')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-50-output-2.png" width="585" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<ul>
<li>On constate que la sensibilité de taux croît avec la maturité et tend à être linéaire.</li>
<li>Pour des paramètres extrêmes <span class="math inline">\(c = \lambda = r = 0\)</span>, la sensibilité (duration) est identique à la maturité comme illustré sur la figure ci-dessous. Cette remarque met en évidence la relation mlathématique entre la sensibilité et la maturité présentée plus haut.</li>
<li>Connaissant la maturité, pour une variation du taux d’intérêt on peut donc donner une estimation “grossière” de la sensibilité (en approximant la duration par 0.8*maturité, par exemple).</li>
</ul>
<div id="01673960" class="cell" data-execution_count="50">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur extrême de la sensibilité (cas extrême de nullité de lambda, r et c)</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>maturity <span class="op">=</span> <span class="bu">range</span>(<span class="dv">1</span>,<span class="dv">21</span>)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>censi <span class="op">=</span> np.array([Sensi(t,<span class="fl">1e-6</span>,T,<span class="fl">1e-6</span>,<span class="fl">1e-6</span>) <span class="cf">for</span> T <span class="kw">in</span> maturity])</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>plt.plot(maturity, censi, label <span class="op">=</span><span class="st">"Duration"</span>)</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Maturité (année)"</span>)</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"Duration"</span>)</span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"Sensibilité du prix du bond en fonction de la maturité (cas extrême)"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="50">
<pre><code>Text(0.5, 1.0, 'Sensibilité du prix du bond en fonction de la maturité (cas extrême)')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-51-output-2.png" width="609" height="450" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimation-de-la-var-dune-obligation." class="level4">
<h4 class="anchored" data-anchor-id="estimation-de-la-var-dune-obligation.">Estimation de la VaR d’une obligation.</h4>
<p>L’estimation de la VaR sur un bond peut se faire à partir de la senssibilité de taux ou par la méthode de repricing.</p>
</section>
<section id="estimation-de-la-var-par-la-sensibilité-du-taux-dintérêt" class="level4">
<h4 class="anchored" data-anchor-id="estimation-de-la-var-par-la-sensibilité-du-taux-dintérêt">Estimation de la VaR par la sensibilité du taux d’intérêt</h4>
<p>L’approche par la sensibilité se présente de la manière suivante:</p>
<p>On suppose que la dynamique du taux d’intérêt est donnée par <span class="math display">\[\Delta r \sim \mathcal{N}(0, \sigma \sqrt{\Delta t})\]</span>.</p>
<p>Sachant que <span class="math display">\[\frac{\Delta P}{P} = - Duration \times \Delta r\]</span></p>
<p>il suit que <span class="math display">\[\frac{\Delta P}{P} \sim \mathcal{N}(0, Duration \times \sigma \sqrt{\Delta t})\]</span></p>
<p>Une approche par la sensibilité de la VaR à 99% donne <span class="math display">\[VaR = Duration \times \sigma \times  \sqrt{\Delta t} \times z_{99\%}\]</span> Où <span class="math inline">\(z_{99\%}\)</span> est le quantile d’ordre 99% de la loi normale standard.</p>
<p>Pour les besoins de notre exercice, on pose <span class="math inline">\(\sigma = 1\%\)</span>.</p>
<div id="557440fb" class="cell" data-execution_count="51">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Calcul de la VaR par la sensibilité du taux d'intérêt</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Sensi_VaR(sigma, H, t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    duration <span class="op">=</span> Sensi(t,c,T,r,lamda, R)</span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a>    var <span class="op">=</span> duration<span class="op">*</span>sigma<span class="op">*</span>np.sqrt(H)<span class="op">*</span>norm.ppf(alpha)</span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> var</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="36623ce3" class="cell" data-execution_count="52">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>sigma<span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>H <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>t <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>lamda <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a>r <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a>c <span class="op">=</span> <span class="fl">0.03</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>T <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>R <span class="op">=</span><span class="fl">0.40</span></span>
<span id="cb77-9"><a href="#cb77-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-10"><a href="#cb77-10" aria-hidden="true" tabindex="-1"></a>Sensi_VaR(sigma , H, t,c,T,r,lamda)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>np.float64(0.05804942383590022)</code></pre>
</div>
</div>
<p>La VaR à 99% d’horizon 1 an sur le bond est de 5.8%. - On note que la VaR est une fonction linéaire croissante de la volatilité. C’est une conséquence directe de l’hypothèse de normalité des variations du taux d’intérêt. Ainsi, une augmentation de la volatilité du taux d’intérêt s’accompagne d’une augmentation de la volatilité du prix du bond. - La VaR est une fonction décroissante du taux d’intérêt. En effet, une augmentation du taux d’intérêt entraîne une diminution de la valeur des bonds, et par conséquent des valeurs extrêmes atteintes par celles-ci; d’où la VaR décroît. Toutefois l’évolution de la VaR en fonction du taux d’intérêt n’est pas linéaire.</p>
</section>
<section id="evolution-de-la-z-var-en-fonction-du-taux-dintérêt" class="level4">
<h4 class="anchored" data-anchor-id="evolution-de-la-z-var-en-fonction-du-taux-dintérêt">Evolution de la Z-VaR en fonction du taux d’intérêt</h4>
<div id="fa916474" class="cell" data-execution_count="53">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evolution de la VaR en fonction de la volatilité</span></span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>vol <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="fl">1e-2</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([Sensi_VaR(sigma , H, t,c,T,r,lamda) <span class="cf">for</span> sigma <span class="kw">in</span> vol])</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>plt.plot(vol, var, label <span class="op">=</span><span class="st">"VaR_99%"</span>)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Volatilité"</span>)</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VaR "</span>)</span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb79-9"><a href="#cb79-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VaR à 99% à horizon 1 an en fonction de la volatilité"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<pre><code>Text(0.5, 1.0, 'VaR à 99% à horizon 1 an en fonction de la volatilité')</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-54-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="ec7d1b21" class="cell" data-execution_count="54">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evolution de la VaR en fonction du taux d'intérêt</span></span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>interest <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([Sensi_VaR(sigma , H, t,c,T,r,lamda) <span class="cf">for</span> r <span class="kw">in</span> interest])</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a>plt.plot(interest, var, label <span class="op">=</span><span class="st">"VaR_99%"</span>)</span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Taux d'intérêt"</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VaR"</span>)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VaR à 99% à horizon 1 an en fonction du taux d'intérêt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="54">
<pre><code>Text(0.5, 1.0, "VaR à 99% à horizon 1 an en fonction du taux d'intérêt")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-55-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="evolution-de-la-z-var-en-fonction-de-lintensité-de-défaut" class="level4">
<h4 class="anchored" data-anchor-id="evolution-de-la-z-var-en-fonction-de-lintensité-de-défaut">Evolution de la Z-VaR en fonction de l’intensité de défaut</h4>
<p>Pour des intensités de défaut croissantes, la VaR du bond décroît de façon exponentielle, ceteris paribus. Tout comme avec le taux d’intérêt, une augmentation de l’intensité de défaut s’accompagne d’une imminence du défaut et par conséquent de la diminution de la valeur du bond. D’où une diminution de la VaR.</p>
<div id="420c8e72" class="cell" data-execution_count="55">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Evolution de la VaR en fonction de l'intensité de défaut</span></span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([Sensi_VaR(sigma , H, t,c,T,r,lamda) <span class="cf">for</span> lamda <span class="kw">in</span> lambdas])</span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a>plt.plot(lambdas, var, label <span class="op">=</span><span class="st">"VaR_99%"</span>)</span>
<span id="cb83-6"><a href="#cb83-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Intensité de défaut"</span>)</span>
<span id="cb83-7"><a href="#cb83-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VaR"</span>)</span>
<span id="cb83-8"><a href="#cb83-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb83-9"><a href="#cb83-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VaR à 99% à horizon 1 an en fonction de l'intensité de saut"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="55">
<pre><code>Text(0.5, 1.0, "VaR à 99% à horizon 1 an en fonction de l'intensité de saut")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-56-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="estimation-de-la-var-par-repricing-de-lobligation" class="level4">
<h4 class="anchored" data-anchor-id="estimation-de-la-var-par-repricing-de-lobligation">Estimation de la VaR par repricing de l’obligation</h4>
<p>La méthodologie consiste à revaloriser le bond pour une variation du taux d’intérêt, puis d’en déduire la variation du prix du bond qui en résulte.</p>
<p><span class="math display">\[
    \Delta r^* =\sigma \times  \sqrt{\Delta t} \times z_{99\%}
\]</span></p>
<p><span class="math display">\[
    VaR_{99\%} = \frac{B(r+ \Delta r^*) - B(r)}{B(r)}
\]</span></p>
</section>
<section id="approche-repricing" class="level4">
<h4 class="anchored" data-anchor-id="approche-repricing">Approche repricing</h4>
<div id="6ef5663c" class="cell" data-execution_count="56">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Approche repricing</span></span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> repricing_VaR(sigma, H, t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.99</span>):</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>    delta_r <span class="op">=</span> sigma<span class="op">*</span>np.sqrt(H)<span class="op">*</span>norm.ppf(alpha)</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a>    B_rep <span class="op">=</span> Bond(t,c,T,r<span class="op">+</span>delta_r,lamda, R)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>    B_r <span class="op">=</span> Bond(t,c,T,r,lamda, R)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb85-8"><a href="#cb85-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>  (B_r <span class="op">-</span> B_rep)<span class="op">/</span>B_r</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="17457c5f" class="cell" data-execution_count="57">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>repricing_VaR(sigma, H, t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, alpha<span class="op">=</span><span class="fl">0.99</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="57">
<pre><code>np.float64(0.05627224378244837)</code></pre>
</div>
</div>
<ul>
<li><p>La VaR obtenue par l’approche repricing, sous les mêmes conditions que précédemment, est de 5.6%. Cette VaR est inférieure à celle obtenue sous l’hypothèse de normalité des variations du taux d’intérêt.</p></li>
<li><p>Ceci s’explique par le fait que la duration est une fonction <strong>convexe décroissante</strong> du taux d’intérêt et représente une approximation affine de la valeur du bond en le taux d’intérêt. De manière générale, l’approche par les sensibilités surestime la VaR.</p></li>
<li><p>L’évolution de la VaR, obtenue par reprincing, en fonction du taux d’intérêt ou de l’intensité de défaut (voir les graphiques ci-dessus) à la même allure que la z-VaR.</p></li>
<li><p>En règle générale la VaR doit être inférieure au seuil de 20% de par la limite règlementaire. L’utilisation de la z-VaR peut donc constituer un manque à gagner pour les institutions financieres. En effet, elles peuvent être amenées à dérisquer leur portefeuille en limitant leur investissements pour des raisons purement techniques.</p></li>
</ul>
<section id="valeur-extrême-de-la-sensibilité-cas-extrême-de-nullité-de-lambda-r-et-c" class="level5">
<h5 class="anchored" data-anchor-id="valeur-extrême-de-la-sensibilité-cas-extrême-de-nullité-de-lambda-r-et-c">Valeur extrême de la sensibilité (cas extrême de nullité de lambda, r et c)</h5>
<div id="f09ff99a" class="cell" data-execution_count="58">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur extrême de la sensibilité (cas extrême de nullité de lambda, r et c)</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>interest <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([repricing_VaR(sigma , H, t,c,T,r,lamda) <span class="cf">for</span> r <span class="kw">in</span> interest])</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>plt.plot(interest, var, label <span class="op">=</span><span class="st">"VaR_99%"</span>)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Taux d'intérêt"</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VaR"</span>)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VaR à 99% à horizon 1 an en fonction du taux d'intérêt"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="58">
<pre><code>Text(0.5, 1.0, "VaR à 99% à horizon 1 an en fonction du taux d'intérêt")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-59-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="valeur-extrême-de-la-sensibilité-cas-extrême-de-nullité-de-lambda-r-et-c-1" class="level5">
<h5 class="anchored" data-anchor-id="valeur-extrême-de-la-sensibilité-cas-extrême-de-nullité-de-lambda-r-et-c-1">Valeur extrême de la sensibilité (cas extrême de nullité de lambda, r et c)</h5>
<div id="5f0afb0d" class="cell" data-execution_count="59">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Valeur extrême de la sensibilité (cas extrême de nullité de lambda, r et c)</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>lambdas <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>, num<span class="op">=</span><span class="dv">100</span>)</span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([repricing_VaR(sigma , H, t,c,T,r,lamda)<span class="cf">for</span> lamda <span class="kw">in</span> lambdas])</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>plt.plot(lambdas, var, label <span class="op">=</span><span class="st">"VaR_99%"</span>)</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"Intensité de saut"</span>)</span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">"VaR"</span>)</span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb90-9"><a href="#cb90-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">"VaR à 99% à horizon 1 an en fonction de l'intensité de défaut"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>Text(0.5, 1.0, "VaR à 99% à horizon 1 an en fonction de l'intensité de défaut")</code></pre>
</div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-60-output-2.png" width="597" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
</section>
</section>
<section id="iii.-risque-de-contrepartie" class="level2">
<h2 class="anchored" data-anchor-id="iii.-risque-de-contrepartie">III. Risque de contrepartie</h2>
<p>Dans le cadre d’un engagement contratuel incluant deux parties prenantes, le <strong>risque de contrepartie</strong> fait reférence au rique de perte suite au défaut d’une des parties à remplir les engagements contractuels pré-établis: c’est un risque bilatéral.</p>
<p>Afin de se couvrir du defaut de l’émetteur d’un bond, l’acheteur du bond peut entrer dans un credit default swap (CDS). Dans un tel contrat, lorsque la contrepartie est correlée à l’émetteur de l’obligation on parle de <em>wrong way risk</em> ce qui a pour conséquence d’exposer davantage le souscripteur. La contrepartie doit donc être décorrelée de l’émetteur.</p>
<p>Le risque de contrepartie est en général mitigé par les appels de marge (chambre de compensation). - Quand la qualité de l’émetteur se dégrade, son spread de crédit spread croît et le CDS s’apprécie. - Si la contrepartie fait défaut, le détenteur perd <span class="math inline">\(CDS = 1-R\)</span>. - Un mécanisme d’appel de marge permet de mitiger le risque.</p>
<section id="lien-entre-cds-et-obligation-la-formule-du-triangle-de-crédit" class="level3">
<h3 class="anchored" data-anchor-id="lien-entre-cds-et-obligation-la-formule-du-triangle-de-crédit">Lien entre CDS et obligation: la formule du triangle de crédit</h3>
<p>Un estimation du taux sans risque d’une obligation: <span class="math display">\[
\begin{aligned}
P &amp;= \sum_{i=1}^{n} c \, e^{-(r+\lambda)T_i}
    + e^{-(r+\lambda)T_n}
    + \lambda R \, \frac{1 - e^{-(r+\lambda)T_n}}{r+\lambda}
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
P &amp;= c \int_0^T e^{-(r+\lambda)t} \, dt
    + e^{-(r+\lambda)T}
    + \lambda R \, \frac{1 - e^{-(r+\lambda)T}}{r+\lambda}
\end{aligned}
\]</span></p>
<p><span class="math display">\[
\begin{aligned}
P &amp;= c \, \frac{1 - e^{-(r+\lambda)T}}{r+\lambda}
    + e^{-(r+\lambda)T}
    + \lambda R \, \frac{1 - e^{-(r+\lambda)T}}{r+\lambda}
\end{aligned}
\]</span></p>
<p>L’obligation est au pair si et seulement si P = 1 Ainsi, <span class="math display">\[
    (c + \lambda R) \frac{ 1- e^{-(r + \lambda )T}}{r + \lambda} + e^{-(r + \lambda)T} = 1
\]</span></p>
<p>Quand T tend vers l’infini le taux sans risque vaut alors, <span class="math display">\[
    (c + \lambda R)  = r + \lambda
\]</span></p>
<p><span class="math display">\[
    (c - r )  = \lambda (1 - R)
\]</span> - <span class="math inline">\(c-r\)</span>: spread ou prime de risque - <span class="math inline">\(\lambda\)</span>: intensité de défaut - <span class="math inline">\(1-R\)</span>: LGD <span class="math display">\[
    Spread = PD \times LGD
\]</span></p>
</section>
<section id="cds-principe" class="level3">
<h3 class="anchored" data-anchor-id="cds-principe">CDS: principe</h3>
<ul>
<li>Premium Leg: est payé tant que l’émetteur est “en vie”. <span class="math display">\[ PL = \int_0^T s \times e^{-rt} \times e^{-\lambda t}dt = s \frac{1-e^{-(r+\lambda)T}}{r + \lambda}\]</span></li>
<li>Default Leg: compensation à la date t si le défaut y survient. <span class="math display">\[DL = \int_0^T(1-R) e^{-rt}\times e^{-\lambda t} dt = \lambda (1-R) \frac{1-e^{-(r+\lambda)T}}{r+\lambda}\]</span>.</li>
</ul>
<p>La valeur initiale d’un spread étant nulle, les deux jambes sont égales et il on obtient:</p>
<p><span class="math display">\[
    s = \lambda (1-R)
\]</span></p>
<p>Un estimation de ce spread peut donc être déduite de la formule du triangle de crédit.</p>
</section>
<section id="sensibilité-de-crédit" class="level3">
<h3 class="anchored" data-anchor-id="sensibilité-de-crédit">Sensibilité de crédit</h3>
<p>La sensibilité de crédit d’une obligation est la variation du prix de l’obligation lorsque varie le spread de crédit de la contrepartie. De la formule du triangle, la sensibilité de crédit peut être déduite de la sensibilité par rapport à l’intensité de défaut <span class="math inline">\(\lambda\)</span>.</p>
<p><span class="math display">\[
    \frac{\partial P}{\partial s} = \frac{1}{1 - R} \frac{\partial P}{\partial \lambda}
\]</span></p>
<p><span class="math display">\[
    \frac{\partial P}{\partial s} \times \frac{1}{P}= \frac{1}{1 - R} \frac{\partial P}{\partial \lambda} \times  \frac{1}{P}
\]</span></p>
<p>On peut calculer une VaR taux et une VaR crédit. Toutefois, la VaR qui sera regardée de près est celle issue de la variation conjointe des taux et des spreads de crédit.</p>
<section id="sensibilité-de-crédit-du-bond" class="level4">
<h4 class="anchored" data-anchor-id="sensibilité-de-crédit-du-bond">Sensibilité de crédit du bond</h4>
<div id="00fbf4ff" class="cell" data-execution_count="60">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilité de crédit du bond</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>delta_lambda <span class="op">=</span> <span class="fl">1e-4</span> <span class="co">#1bp</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> Sensi_credit(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.4</span>, delta_lambda <span class="op">=</span> <span class="fl">1e-4</span>):</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a>    B_t <span class="op">=</span> Bond(t,c,T,r,lamda, R)</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>    variation <span class="op">=</span> <span class="op">-</span>(Bond(t,c,T,r,lamda<span class="op">+</span>delta_lambda, R)<span class="op">-</span>B_t)<span class="op">/</span>(delta_r<span class="op">*</span>B_t)</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> variation<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>R)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="9707e9d0" class="cell" data-execution_count="61">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>Sensi_credit(t,c,T,r,lamda)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="61">
<pre><code>np.float64(8.82119086802735)</code></pre>
</div>
</div>
<ul>
<li><p>Une variation d’un point de pourcentage du spread de crédit entraîne une variation de 8.82% de la valeur du bond. Cette sensibilité de crédit est assez proche de la sensibilité taux. En effet, on observe de l’écriture mathématique de la valeur du bond que le taux d’intérêt et l’intensité apparaissent conjointement de façon additive (sauf pour le terme de recouvrement).</p></li>
<li><p>Ces deux sensibilitées sont identiques pour un taux de recouvrement nul.</p></li>
</ul>
<div id="cf4fb65b" class="cell" data-execution_count="62">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>Sensi_credit(t,c,T,r,lamda, R <span class="op">=</span> <span class="fl">0.0</span>, delta_lambda <span class="op">=</span> <span class="fl">1e-4</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>np.float64(8.77911216566412)</code></pre>
</div>
</div>
</section>
</section>
<section id="estimation-de-la-var-par-variation-conjointe-du-taux-dintérêt-et-du-spread-de-crédit" class="level3">
<h3 class="anchored" data-anchor-id="estimation-de-la-var-par-variation-conjointe-du-taux-dintérêt-et-du-spread-de-crédit">Estimation de la VaR par variation conjointe du taux d’intérêt et du spread de crédit</h3>
<p>On suppose que la dynamique du taux d’intérêt est donnée par l’EDS</p>
<p><span class="math display">\[
    dr_t = \sigma dW_t
\]</span></p>
<p>Le spread ne prenant pas de valeur négative, on supposera qu’il est log-normal. Sa dynamique est donnée par l’EDS</p>
<p><span class="math display">\[
    \frac{ds_t}{s_t} = \alpha dZ_t
\]</span></p>
<p>En supposant <span class="math inline">\(dW_t dZ_t = \rho\)</span> et <span class="math inline">\(Z_t = \rho W_t + \sqrt{1-\rho^2}V_t\)</span> tel que <span class="math inline">\(dV_t dW_t = 0\)</span>,</p>
<p>La dynamique du spread s’écrit alors <span class="math display">\[
\frac{ds_t}{s_t} = \alpha (\rho W_t + \sqrt{1-\rho^2}V_t)
\]</span></p>
<p>En appliquant un schéma de discrétisation d’Euler, on peut alors simuler les taux <span class="math inline">\(r_t\)</span> et les spreads <span class="math inline">\(s_t\)</span> par:</p>
<p><span class="math display">\[
    r_H = r + \sigma \sqrt{H} W_H
\]</span></p>
<p><span class="math display">\[
    s_H = s(1 + \alpha \rho \sqrt{H} W_H + \alpha \sqrt{1-\rho^2} \sqrt{H} V_H)
\]</span></p>
<p>Où H est le pas de discrétisation.</p>
<p>La méthodologie de détermination de la sensibilité du prix d’une obligation conjointement au taux d’intérêt et au spread de crédit est la suivante: - Calculer la valeur du bond pour les paramètres initiaux - Simuler les taux <span class="math inline">\(r_H\)</span> et les spreads <span class="math inline">\(s_H\)</span> - Pour chaque simulation, calculer la valeur du bond (cetertis paribus) - pour déterminer la variation des nouveaux prix par rapport au prix initial - calculer le quantile d’ordre 99% des variations obtenues</p>
<div id="42f2f0d2" class="cell" data-execution_count="63">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sensibilité conjointe de taux et de crédit</span></span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> SimSpread(c,T,r,lamda, R, alpha, rho, H <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>, M<span class="op">=</span><span class="dv">10_000</span>):</span>
<span id="cb97-4"><a href="#cb97-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-5"><a href="#cb97-5" aria-hidden="true" tabindex="-1"></a>    u1 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>,<span class="dv">1</span>, size <span class="op">=</span> M)</span>
<span id="cb97-6"><a href="#cb97-6" aria-hidden="true" tabindex="-1"></a>    u2 <span class="op">=</span> np.random.uniform(<span class="dv">0</span>,<span class="dv">1</span>, size <span class="op">=</span> M)</span>
<span id="cb97-7"><a href="#cb97-7" aria-hidden="true" tabindex="-1"></a>    w <span class="op">=</span> norm.ppf(u1)</span>
<span id="cb97-8"><a href="#cb97-8" aria-hidden="true" tabindex="-1"></a>    v <span class="op">=</span> norm.ppf(u2)</span>
<span id="cb97-9"><a href="#cb97-9" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> lamda<span class="op">*</span>(<span class="dv">1</span><span class="op">-</span>R)</span>
<span id="cb97-10"><a href="#cb97-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-11"><a href="#cb97-11" aria-hidden="true" tabindex="-1"></a>    r_H <span class="op">=</span> r <span class="op">+</span> sigma<span class="op">*</span>np.sqrt(H)<span class="op">*</span>w</span>
<span id="cb97-12"><a href="#cb97-12" aria-hidden="true" tabindex="-1"></a>    s_H <span class="op">=</span> s<span class="op">*</span>(<span class="dv">1</span> <span class="op">+</span> alpha<span class="op">*</span>rho<span class="op">*</span>np.sqrt(H)<span class="op">*</span>w <span class="op">+</span> alpha<span class="op">*</span>np.sqrt(<span class="dv">1</span><span class="op">-</span>rho<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>np.sqrt(H)<span class="op">*</span>v)</span>
<span id="cb97-13"><a href="#cb97-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb97-14"><a href="#cb97-14" aria-hidden="true" tabindex="-1"></a>    P_0 <span class="op">=</span> Bond(<span class="dv">0</span>,c,T,r,lamda, R)</span>
<span id="cb97-15"><a href="#cb97-15" aria-hidden="true" tabindex="-1"></a>    P_1 <span class="op">=</span> Bond(H,c,T,r_H,s_H<span class="op">/</span>(<span class="dv">1</span><span class="op">-</span>R), R)</span>
<span id="cb97-16"><a href="#cb97-16" aria-hidden="true" tabindex="-1"></a>    mu <span class="op">=</span> (P_1 <span class="op">-</span> P_0)<span class="op">/</span>P_0</span>
<span id="cb97-17"><a href="#cb97-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span>  <span class="op">-</span> np.quantile(mu,<span class="fl">0.01</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div id="f2c2de5a" class="cell" data-execution_count="64">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>sigma <span class="op">=</span> <span class="fl">0.01</span> <span class="co"># Volatilité du taux d'intérêt</span></span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>alpha <span class="op">=</span><span class="fl">0.4</span>   <span class="co"># Volatilité du spread</span></span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>rho <span class="op">=</span> <span class="fl">0.4</span>    <span class="co"># Corrélation entre le spread et le taux d'intérêt</span></span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb98-5"><a href="#cb98-5" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">90</span>) <span class="co"># Pour la reproductibilité</span></span>
<span id="cb98-6"><a href="#cb98-6" aria-hidden="true" tabindex="-1"></a>SimSpread(c,T,r,lamda, R, alpha, rho, H <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>np.float64(0.0602691861203251)</code></pre>
</div>
</div>
<div id="4eb592f1" class="cell" data-execution_count="65">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">90</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>rhos <span class="op">=</span> np.linspace(<span class="dv">0</span>,<span class="dv">1</span>, num<span class="op">=</span> <span class="dv">1000</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>var <span class="op">=</span> np.array([SimSpread(c,T,r,lamda, R, alpha, rho, H <span class="op">=</span> <span class="dv">1</span><span class="op">/</span><span class="dv">12</span>) <span class="cf">for</span> rho <span class="kw">in</span> rhos])</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>plt.plot(rhos, var)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="demo_files/figure-html/cell-66-output-1.png" width="587" height="412" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>La corrélation <span class="math inline">\(\rho\)</span> doit être positive, car une augmentation des taux d’intérêt entraîne une meilleure rémunération du marché par rapport aux obligations. Pour rester attractifs, les coupons doivent alors augmenter. Cette hausse des coupons accroît le coût de financement de l’émetteur, ce qui conduit à une augmentation du spread de crédit. Il en résulte une corrélation positive entre les taux d’intérêt et les spreads de crédit.</p>
<p>Une augmentation conjointe des taux et des spreads accroît le risque de défaut, en raison de la corrélation positive entre ces deux facteurs de risque. Ainsi, une corrélation élevée reflète un manque de diversification, ce qui expose davantage le portefeuille au risque systémique</p>
</section>
</section>
<section id="iv.-risque-modèle" class="level2">
<h2 class="anchored" data-anchor-id="iv.-risque-modèle">IV. Risque modèle</h2>
<p>Le risque modèle désigne le risque associé à l’utilisation d’un modèle mathématique ou statistique qui ne représente pas correctement la réalité ou qui mène à des décisions erronées en finance et en gestion des risques.</p>
<p>Eléments du suivi du risque modèle: - Sanity check: Ecart de performance - Backtesting: Application aux données antérieures - Comparaison avec desmodèles plus riches - Provisionner au titre du risque de modèle</p>
</section>
<section id="v.risque-climatique" class="level2">
<h2 class="anchored" data-anchor-id="v.risque-climatique">V.Risque climatique</h2>
<p>Le risque climatique désigne les risques financiers liés au changement climatique et aux politiques de transition vers une économie bas carbone. Sa modélisation reste complexe, notamment en raison du manque de données historiques et de l’absence d’un cadre réglementaire clairement défini.</p>
<p>On distingue deux principaux types de risques climatiques :</p>
<ul>
<li><p>Risque physique: l correspond aux pertes financières causées par des événements climatiques extrêmes. Il est défini par deux éléments clés : la fréquence et la sévérité des événements.</p>
<ul>
<li>Risque aigu : Événements rares mais très intenses ( ouragans, inondations).</li>
<li>Risque chronique : Changements progressifs et durables (élévation du niveau de la mer).</li>
</ul></li>
<li><p>Risque de transition: il découle de l’adaptation des entreprises et des acteurs économiques aux exigences de transition écologique.</p>
<ul>
<li>Risque politique et réglementaire : Durcissement progressif des régulations environnementales (taxe carbone).</li>
<li>Opportunités technologiques : Innovations favorisant la transition énergétique et redéfinissant les modèles économiques.</li>
</ul></li>
</ul>
<p>La resilience des institutions financieres notamment aux changement climatique est évaluée via des stress tests climatiques dont les scénarios sont issus des données du NGFS (Network for Greening financial System).</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>